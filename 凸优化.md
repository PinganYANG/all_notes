## 凸优化

#### 0.引言

##### 0.1 优化/数学规划 optimization/mathematical programming

从一个可行解的集合当中寻找出来的所有元素
$$
minimize\  f_0(x)\newline
subject\ to\ f_i(x)\leq b_i, i = 1,...,M
\newline
$$
$ x = [x^q,...,x^M]^T \ optimization \ variable$

$f_0: R^n \rightarrow R \ objective \ function$

$f_i: R^n \rightarrow R \ inequality\ function$

优化的目的是找到最优的$X^* \ optimal \leftrightarrow \forall z, z \isin \{f_i(z) \leq b_i,i = 1,...m \} and f_0(z) \leq f_0(x^*)$

$ z \isin \{f_i(z) \leq b_i,i = 1,...m \}$ 表示一个可行解集合



###### 例子：数据拟合问题

一个拟合二次函数的拟合问题，对于类似 $y=ax^2+bx+c$ 问题即：

$min  \ \ \epsilon_1^2 + ...+\epsilon_n^2 $，$\epsilon_i=y_i-ax_i^2+bx_i+c$



###### 例子：线性二次调节器LQR问题

$X_K = AX_{K-1} + B\times u_K$ (控制系统的一个内容) $A$ 是【状态转移矩阵】，$B$是【输入矩阵】,$u_K$是【输入】，$X$ 是状态

$\underset{u}{\min} \ J = \sum^N_{K=1}{(X_K^T QX_K+u^T_KRu_K)}$

最小化这些量的和，第一项$X_K^T QX_K$表示，Q是I矩阵时，相当于状态的方差，要让目标的方差最小

第二项$u^T_KRu_K$是输入的方差，要让输入的能量最小。因此要让输入的能量有限来控制系统。



###### 例子：多用户的能量控制问题

假设在一个三维空间内，有很多发送者$T_x$和接受者$R_x$,一对发送者和接受者成为一个用户。在空间中有大量的用户，即为$u_i$。每个用户以能量$P_i$发送信号。且能量非负并有上限$0\leq P\leq b_i$

一个用户的能量会对另一个用户产生干扰$\alpha_{ij}$,i对j的干扰

高斯噪声为$\delta^2$

SINR 信干噪比:

$SINR_i = \frac{P_i}{\delta^2_i+\sum_{j\neq i}{\alpha_{ji}P_i}}$

用户的信道容量 $f_i$ 正比于$log(1+SINR_i)$

这样有优化问题:

$max \sum_{i=1}^M f_i$

$subject\ to\ 0\leq P\leq b_i$





###### 例子：图像处理问题

二维图形$\Phi_0(x,y)$ 是一个带噪声的图像，希望恢复为一个不带噪声的图像 $\Phi(x,y)$ 

如果没有任何先验知识的情况下，其实很难分离出来这么多的先验知识。但我们知道自然图像一般是有规律的。

那么我们规定一个TV范数 $Total \ Variation (TV)$，图像在TV范数下是分辨光滑的。

$||\Phi||_{TV} = \sum_y{\sum_x{\sqrt{(\Phi(x,y) - \Phi(x,y-1))^2+(\Phi(x,y) - \Phi(x-1,y))^2}}} $

目的是求：

$\underset{\Phi}{\min} \ ||\Phi||_{TV} + \lambda ||\Phi - \Phi_0||^2_F$

后一项相当于正则化。其中后一项是F范数，表示矩阵所有元素的平方加和再开根号。



###### 例子：超大规模集成电路设计

门电路集合$\{g_1,...,g_n\}$

要把门电路连接成一个有向图，并使得系统能完成一定功能，且系统可以达到一些性能指标（比如能耗最小等等）【典型的OR问题】

那么可能的链接有 $\{t_1,...,t_n\}$

那么我们有

$max \ P(x)$

$st \ x \isin \{t1,...,t_n\}$



###### 例子：最短路径问题【典，是真的典】

一个无向图 $\{v_1,...,vn\}$，每个边都有一个权重$\{w_1,...,w_n\}$，给一个起点，找到终点的最短路径。

这样的问题可以写作，E是边
$$
min \ \sum_{i,j \isin E}{w_{ij}x_{ij}}
\newline
s.t. x_{ij} = 0,1
\newline
s.t. \ \sum_j{x_{ij}} -\sum_j{x_{ji}}=  
\begin{equation}
\left\{ 
\begin{array}{lr}
1, i=S \\
-1, i = D\\
0\ otherwise
\end{array} 
\right.
\end{equation}
$$


S,D保证起点终点。使得【终点\起点】只有一条线链接，只有进或出。其他点链接两条，有进出。



##### 0.2 线性规划/非线性规划

###### 线性规划

对于函数$f_i(\alpha x + \beta y) = \alpha f_i(x) + \beta f_i(y) \forall i =0,1,...,m$，这就是一个线性函数【线性可分性】

对于优化问题：
$$
minimize\  f_0(x)\newline
subject\ to\ f_i(x)\leq b_i, i = 1,...,M
\newline
$$
约束中的所有的f都是线性函数，那么就是一个线性规划问题。

线性规划问题的**最优解一定在定点或边上**



###### 非线性规划

对于以上优化问题，有一个或多个约束非线性，则是非线性规划



##### 0.3 凸规划/非凸规划

###### 凸规划

函数满足$f_i(\alpha x + \beta y) \leq \alpha f_i(x) + \beta f_i(y) \forall i =0,1,...,m$，则是一个**凸函数**

凸规划问题中的

- 可行解集要是一个凸集

- 目标函数时一个凸函数



【二次曲线就是一个凸函数

凸规划比非凸规划更好解决

##### 0.4 光滑/非光滑

主要针对目标函数$f_0(x)$ 而言的。光滑就处处可微的。

##### 0.5 连续/离散

主要针对可行域而言。

可行域是：

- 连续的
- 离散的【一些格点/整数 整数规划



##### 0.6 单目标/多目标

多目标时可能无法同时满足两个最优。

那么要用一个**帕累托曲线 pareto front** 来找一个**帕累托最优**

一般可以：

- 通过加权来将多目标转化为单目标问题。



求解一些非线性问题可以转化为相应的非线性优化问题

$f(x) > 0 \ \ \rightarrow \ min\ f^2(x)$



##### 0.7 一些优化领域的历史

##### 【略 



#### 1.仿射/凸/凸锥 + 集/组合/包 Convex set

鉴于最优化问题就是从可行域中找到问题的最优解，可以化成如下问题形式：
$$
minimize\  f_0(x)\newline
subject\ to\ f_i(x)\leq b_i, i = 1,...,M
\newline
x = [x_1,...,x_n]^T
$$

##### 1.1 仿射集 Affine sets

对于**直线**

$ x_1 \neq x_2 \isin R^n, \ \theta \isin R$

$y = \theta x_1 + (1-\theta)x_2 = x_2 + \theta(x_1 - x_2)$

对于**线段**

$ x_1 \neq x_2 \isin R^n, \ \theta \isin [0,1]$

$y = \theta x_1 + (1-\theta)x_2 = x_2 + \theta(x_1 - x_2)\ \ $



###### 1.1.1 定义

**仿射集**（简单定义）：一个集合C是仿射集，若$\forall x_1,\ x_2 \isin C$ 则链接$x_1$与$x_2$的直线也在集合内

数学形式： $x_1,x_2 \ \isin \ C, \ C是仿射集\ , \  \theta x_1 + (1-\theta)x_2 \isin C$

**泛化定义**：如果一个集合是一个仿射集，那么所有的仿射组合也一定属于这个仿射集

数学形式：

设 $x_1,...,x_k \isin C, \theta_1,...,\theta_k \isin R, \ \theta_1+...+\theta_k = 1$

###### 1.1.2 仿射组合

仿射组合有： $\theta_1 x_1 + ... + \theta_k x_k $ 【一个点

- 如果一个集合是一个仿射集，那么所有的放射组合也一定属于这个仿射集，即：

$\theta_1 x_1 + ... + \theta_k x_k \isin C$ 【如果k等于2，那么这个定义退化为上面的定义



**证明**：

有仿射集$C, x_1,x_2,x_3 \isin C$

有$\theta_1, \theta_2,\theta_3 \isin R \ and \ \theta_1 + \theta_2 + \theta_3 = 1$

则有：

$\frac{\theta_1}{\theta_1+\theta_2}x_1 +\frac{\theta_2}{\theta_1+\theta_2}x_2 \ \ \isin C$

则有：
$$
(\theta_1+\theta_2)(\frac{\theta_1}{\theta_1+\theta_2}x_1 +\frac{\theta_2}{\theta_1+\theta_2}x_2) + (1-\theta_1-

\theta_2 )x_3 \isin C
$$
展开得：

$\theta_1 x_1+\theta_2 x_2+\theta_3 x_3 \ \isin \ C$

进而推广可以证明。



可以看到，从简单定义可以推到泛化定义，同时也可以反推。





【所有点直线扩展出来的所有集合都是仿射集】



- 一条直线一定是仿射集

- 一个线段不是



###### 1.1.3 性质

有定义：

$x_1,x_2 \ \isin \ C, \ C是仿射集\ , \  \theta x_1 + (1-\theta)x_2 \isin C$

那么

$\alpha x_1+ \beta x_2 , \alpha,\beta \isin R 是否属于C?$

答： 除非$\alpha + \beta = 1$

那么是否存在有特殊情况来满足这种普遍性质呢？

当然有！【相当于把C平移了$x_0$
$$
V = C - x_0 = \{ x - x_0|x\isin C,\forall x_0 \isin C\}
$$
在这种条件下，我们称$V$为和$C$相关的子空间。

有：

- $V$是一个仿射集
- $V$满足$\alpha x_1+ \beta x_2 \isin V , \alpha,\beta \isin R $
- 这个子空间一定要经过原点

证明 $\forall V_1,V_2 \isin V,\forall \alpha, \beta \isin R \rightarrow \alpha V_1+ \beta V_2 \isin V$：
$$
\alpha V_1+ \beta V_2 + x_0 \isin C

\newline
\because \alpha(V_1+x_0)\isin C,\alpha(V_2+x_0) \isin C,(1-\alpha-\beta)x_0 \isin C
\newline
\therefore \alpha(V_1+x_0) +\alpha(V_2+x_0) +(1-\alpha-\beta)x_0 \isin C
$$


###### 例子： 线性方程组的解集是仿射集 【重要！！】【反过来也对】

有线性方程组的解集：
$$
C = \{x|Ax=b\},A \isin R^{m\times n},b \isin R^{m},x \isin R^{n}
$$
证明C是仿射集

证明：
$$
\forall x_1,x_2 \isin C, Ax_1 = b, Ax_2 = b
，
\theta \isin R

\newline
A(\theta x_1 + (1-\theta)x_2) = \theta A x_1 + (1-\theta)Ax_2 = b
\newline
\therefore \theta x1 +(1-\theta)x_2 \isin C
$$

$$
V =  \{ x - x_0|x\isin C\},\forall x_0 \isin C
\newline
=\{x - x_0|Ax = b\}, Ax_0 = b
\newline
=\{x - x_0|A(x-x_0) = 0\}
\newline
=\{y|Ay=0\}
$$

$\{y|Ay=0\}$这一关于y集合也被称为A的零空间。





##### 1.2 仿射包 aff c

给定任意集合C，C不一定是仿射集，那么如何在C上构造一个最小仿射集？

定义：
$$
aff \ C = \{\theta_1 x_1 + ... + \theta_k x_k |\forall x_1,...,x_k \isin C,\forall \theta_1+...+\theta_k =1\}
$$
就是在C中任意选择k个点，对其进行仿射组合，就可以得到一个**仿射包**的集合

- 空间内两点的**仿射包**就是两点之间的直线
- 空间内不共线3点的**仿射包**就是整个平面
- 仿射集的仿射包就是仿射集本身



##### 1.3 凸集 convex set

###### 1.3.1定义

一个集合C是凸集，当任意两点之间的线段仍然在C内。【相当于为仿射集的约束加上$1>=\theta_i>=0$?

数学定义：

$C为凸集 \leftrightarrow \ \theta x_1 +(1-\theta)x_2, \forall x_1,x_2 \isin C, \forall \theta, \theta \isin [0,1] \ \ $

可以说，仿射集就是凸集的特例。

##### 1.4 凸组合 

数学形式：

设 $x_1,...,x_k \isin C, \theta_1,...,\theta_k \isin R, \ \theta_1+...+\theta_k = 1,\theta_i\isin[0,1]$

凸组合有： $\theta_1 x_1 + ... + \theta_k x_k $ 

【类比于仿射组合，只多加了$\theta_i\isin[0,1]$的限制条件】



- 任意的一个集合C如果是凸集，那么从凸集中选取任意K个点的凸组合也仍然是凸集【对应于仿射集的这个定义



##### 1.5 凸包 Conv c

定义：

给定任意集合C，C不一定是凸集，那么凸包为：
$$
Conv \ C = \{\theta_1 x_1 + ... + \theta_k x_k |\forall x_1,...,x_k \isin C, \theta_1+...+\theta_k  =1,\forall \theta_1,...,\theta_k \isin [0,1]\}
$$
【相当于说是把C中任意两点连接成线段，任意多点向内线性组合】

- 甜甜圈不是凸集，但其凸包为一个圆面
- 离散格点的凸包则是最小凸的包络线

##### 1.6 锥 cone 凸锥 convex cone

###### 1.6.1 锥的定义：

$C是锥 \leftrightarrow \forall x \isin C, \theta \ge0 有 \theta x \isin C$

###### 1.6.2 凸锥的定义：

$C是凸锥 \leftrightarrow \forall x_1,x_2 \isin C; \theta_1,\theta_2 \ge0; 有 \theta_1 x_1 +\theta_2 x_2 \isin C$

 【非负约束有点仅向外扩张的感觉

**【凸锥一定经过原点】**



##### 1.7 凸锥组合

数学形式：

设 $x_1,...,x_k \isin C, \theta_1,...,\theta_k \isin R, \ \theta_1,...,\theta_k \ge 0$

凸锥组合有： $\theta_1 x_1 + ... + \theta_k x_k $ 



##### 1.8 凸锥包

$$
 \{\theta_1 x_1 + ... + \theta_k x_k |\forall x_1,...,x_k \isin C,\forall \theta_1,...,\theta_k \ge 0\}
$$

![img](https://pic1.zhimg.com/80/v2-452015b19f480841e184728d6cab4e6c_720w.webp)

【包含C最小的一个‘冰淇淋’:ice_cream:

##### 1.9 三种组合比较

$仿射组合\ \ \ \forall \theta_1,...,\theta_k,\theta_1+...+\theta_k  =1$

$凸组合\ \ \ \forall \theta_1,...,\theta_k,\theta_1+...+\theta_k  =1,\forall \theta_1,...,\theta_k \isin [0,1]$

$凸锥组合\ \ \ \forall \theta_1,...,\theta_k,\theta_1,...,\theta_k \ge 0$



任意的仿射集一定是凸的，任意一个仿射组合在集合内的话，那么他的凸组合也一定在集合内。那么仿射组合就是凸组合的一个特例。

同理，凸锥组合也是凸组合的一个特例。



以上的定义有一个小问题，就是都假定了有两个点。而可以把这个定义扩充到单点。

**任意的一个单点一定是仿射集，一定是凸集，但并不是凸锥，除非其在原点。**



**而空集既是仿射集，又是凸集，也是凸锥**



#### 2.几种重要的凸集

##### 2.1 $\mathbb{R}^n$空间

是仿射集，是凸集，是凸锥

##### 2.2 $\mathbb{R}^n$空间的子空间

而从中任意选择一个子空间的话，是不是还满足三个集合呢？

首先要搞明白空间或者子空间的定义或者说性质。空间和子空间的一个性质就是：

- 必然经过原点
- 其空间内元素的加减乘除运算结果仍落在其中



这样在其这种性质的加持之下，$\mathbb{R}^n$空间的子空间也必然是仿射集，是凸集，是凸锥了。



##### 2.3 任意一条直线

一定是仿射集，一定是凸集，但只有其经过原点时才是一个凸锥【或者说一个直线在经过原点时，他就变成了一个高维空间的子空间了



##### 2.4 任意线段

线段一定是凸集，但线段退化为点是，线段才是仿射集，而当线段退化成的点落在原点时，他才是凸锥



##### 2.5集合 $\{x_0 +\theta v|\theta \ge 0\} \ \ x_o \isin R^n, \ \ \theta \isin R, \ \ v\isin R^n$



##### 

这时一个射线，沿着v方向的射线。除非v为0时，退化为一个点，这时才是仿射集。

任何情况下都是凸集。

在$x_0=0$时就是一个凸锥。



##### 2.6 超平面 hyperplane 与半空间 half space

###### 超平面：

$$
\{x|a^Tx=b\},\ \ x,a\isin R^n,~~b\isin R,~~a\ne 0
$$

【线性方程组的解空间？

超平面是一个仿射集。

是一个凸集。

只有其经过原点时才是一个凸锥。



###### 半空间：

超平面将空间分成的两个空间叫半空间
$$
\{x|a^Tx\le b\},\ \ x,a\isin R^n,~~b\isin R,~~a\ne 0
\newline
\{x|a^Tx\ge b\},\ \ x,a\isin R^n,~~b\isin R,~~a\ne 0
$$
两个半空间。

半空间是一个凸集。

半空间不是一个仿射集。

当分割空间的超平面过原点时，其形成的半空间才是凸锥。





##### 2.7 球和椭球

定义限制在欧式空间之内

###### 球：

$$
B(x_c,r)=\{x|\Vert x-x_c \Vert_2 \le r \} = \{x|\sqrt{(x-x_c)^T(x-x_c)}\le r \}
$$

是一个凸集，仅半径为0时是仿射集，仅半径为0且落在原点时是凸锥。



###### 证明其是凸集：

$$
\forall x_1,x_2 \isin B, ~~~\Vert x_1 - x_c \Vert \le r,~~~\Vert x_2 - x_c \Vert \le r
\newline
证明：\forall 0\le\theta \le 1,~~~ \Vert\theta x_1 +(1-\theta)x_2-x_c\Vert_2\le r
\newline
\Vert\theta x_1 +(1-\theta)x_2-x_c\Vert_2 = \Vert\theta (x_1-x_c) +(1-\theta)(x_2-x_c)\Vert_2 
\newline
利用三角不等式 \Vert a+b\Vert \le \Vert a \Vert+\Vert b \Vert \newline
\le \Vert\theta (x_1-x_c)\Vert_2 +\Vert(1-\theta)(x_2-x_c)\Vert_2\newline
\theta\Vert x_1-x_c\Vert_2 +(1-\theta)\Vert x_2-x_c\Vert_2 \le r \newline
因为x_1和x_2都在球之内
$$

###### 椭球：

$$
\epsilon(x_c,r,P) =\{x|(x-x_c)^TP^{-1}(x-x_c)\le 1\},~~ x_c\isin R^n,~~~ P\isin S^n_{++}（表示是对称~正定矩阵）
$$

举个例子，比如$P=r^2I_n$时，回带P，就会使椭球变成了一个球了。

矩阵P描述的就是椭球的**半轴长**，这个半轴长就是由P的**奇异值**决定的

【矩阵A的奇异值和特征值是不一样的:face_with_thermometer:我他妈的一直以为是一样的

【奇异值是$\sqrt{eig(A^T A)}$



##### 2.8 多面体 polyhedron

$$
P = \{x
\begin{equation}
\left|
\begin{array}{lr}
a_j^Tx \le b_j,~~j=1,...,m \\
a_j^Tx = d_j,~~j=1,...,n \\


\end{array}
\right.
\end{equation}

\}
$$

一些半空间和一些超平面的交集【即满足一系列等值和不等式的线性规划解集构成的空间】

多面体不一定是有界的。

多面体一定就是一个凸集。



##### 2.9 单纯形 simplex

$\mathbb{R}^n$空间中选择$v_0,...,v_k$共k个点，其中$v_1-v_0,...,v_k-v_0$k个向量线性无关，则与上述点相关的单纯形为：
$$
C=Conv\{v_0,...,v_k\}=\{\theta_0 v_0+...+\theta_k v_k,~~ \Theta \ge0,~~\sum\Theta=1 \}
$$
找k+1个线性无关的点的凸包就是单纯形。

**单纯形就是多面体的一种 simplex is polydedron** 

证明：
$$
x\isin C\isin \mathbb{R}^n,~~C~ is ~simplex \leftrightarrow x=\theta_0 v_0+...+\theta_k v_k,\Theta \ge0,~~\sum\Theta=1 ,\ v_1-v_0,...,v_k-v_0线性无关
\newline
$$
定义两个向量 y 和 B：
$$
[\theta_1~~...~~\theta_k]^T=y,~~y\ge 0,1^Ty\le1
\newline
[v_1-v_0~~...~~v_k-v_0] = B\isin \mathbb{R}^{n\times k}
$$

$$
x\isin C \leftrightarrow x=\theta_0 v_0+...+\theta_k v_k = v_0 + \theta_1(v_1-v_0)+...+\theta_1(v_k-v_0)=v_o+By~~~~(1)
$$

已知B有k个线性无关的向量，则$rank(B)=K$，B是一个列满秩的矩阵$(k\le n)$。

那么B一定可以变化为：
$$
\begin{equation}
\left[
\begin{array}{lr}
I_k \leftrightarrow k\times k\\
0 \leftrightarrow n-k\times k\\


\end{array}
\right]
\end{equation}
$$
利用一个非奇异矩阵$A=\begin{equation}\left[\begin{array}{lr}A_1\\A_2\end{array}\right]\end{equation}\isin\mathbb{R}^{n\times n}$，使得$AB=\begin{equation}\left[\begin{array}{lr}A_1\\A_2\end{array}\right]\end{equation}B=$$\begin{equation}\left[\begin{array}{lr}I_k\\0\end{array}\right]\end{equation}$

对于式子1，两遍同乘A，有$Ax=Av_0+ABy$

有$\begin{equation}\left[\begin{array}{lr}A_1\\A_2\end{array}\right]\end{equation}x $$= \begin{equation}\left[\begin{array}{lr}A_1\\A_2\end{array}\right]\end{equation}v_0$$+\begin{equation}\left[\begin{array}{lr}A_1 B\\A_2 B\end{array}\right]\end{equation}y$

有$\begin{equation}\left\{\begin{array}{lr}A_1x=A_1 v_0+y\\A_2x=A_2 v_0\end{array}\right.\end{equation}$

在这个式子中，y是有一定限制的可变量，因此可以把等式变化为不等式：
$$
\begin{equation}\left\{\begin{array}{lr}A_1x \ge A_1 v_0\\ 1^TA_1x\le1+1^TA_1v_0\\A_2x=A_2 v_0\end{array}\right.\end{equation}
$$
因此任意一个单纯形可以由

- 两个线性不等式和
- 一个线性等式

构成，因此符合多面体的定义，证毕【注意y是一个遍历整个集合内的，是一个整体的概念



##### 2.10 对称矩阵集合 

$\mathbb{S}^n=\{x\isin \mathbb{R}^{n\times n}|x=x^T\}$

他是一个凸锥，也是一个凸集【显然



##### 2.11 对称半正定矩阵集合

$\mathbb{S}_{+}^n=\{x\isin \mathbb{R}^{n\times n}|x=x^T,~~x\succeq 0\}$【$\succeq$表示正定的，即**特征值**大于0，不是全部元素大于0

证明$\mathbb{S}_{+}^n$是一个凸锥：$\forall \theta_1,\theta_2 \ge 0, \forall A,B \isin \mathbb{S}_{+}^n$证明 $ \theta_1 A+\theta_2 B\ge 0 \isin \mathbb{S}_{+}^n$

如果矩阵是半正定的，则必然有$\forall x \isin R^n, x^TAx \ge 0,~~, x^TBx \ge 0$

则
$$
x^T(\theta_1 A+\theta_2 B)x  = x^T\theta_1 Ax +x^T\theta_2 Bx \ge0
$$
因此$\mathbb{S}_{+}^n$是凸锥，所以他也一定是一个凸集



在一个$\mathbb{S}_{+}^2$中，他一定可以表现为右侧形式：$\mathbb{S}_{+}^2=\{\begin{equation}\left[\begin{array}{lr}x~~~y\\y~~~z\end{array}\right]\end{equation}|x\ge 0,~~z\ge 0,xz\ge y^2\}$，

##### 2.11 对称正定矩阵集合

$\mathbb{S}_{++}^n=\{x\isin \mathbb{R}^{n\times n}|x=x^T,~~x> 0\}$

但$\mathbb{S}_{++}^n$就不是凸锥了，但是是一个凸集。

考虑n=1的情况，即只有1维，$n=1,~~\mathbb{S}_{+}^n=R^{+},~~\mathbb{S}_{++}^n=R^{++}$

$R^{++}$是不包含原点的，这样$\mathbb{S}_{++}$是一个凸集，但不是一个凸锥。



考虑2.11中的证明，如果矩阵是正定的，那么有$\forall x \isin R^n, x^TAx > 0,~~ x^TBx > 0$

则
$$
x^T(\theta_1 A+\theta_2 B)x  = x^T\theta_1 Ax +x^T\theta_2 Bx >0时，\theta_1或\theta_2不能同时取到0，这样就不满足凸锥的定义了。但他满足凸集的定义。
$$


#### 3.凸集的交集，保凸运算

很多的凸集都是由一些基本的凸集变换得到的

##### 3.1 交集

若$S_1,S_2$为凸，则$S_1\cap S_2$一定也是为凸集

推广：

若$S_a$为凸集，$\forall a\isin A, \underset{a\isin A}{\cap}S_a$也一定是凸集【一个凸集合的集合的任意子集的交集

但并集不一定！

##### 3.2 仿射函数

定义：

$f:\mathbb{R}_n \rightarrow \mathbb{R}_m$是仿射的，当$f(x)=Ax+b,~~A\isin \mathbb{R}^{m\times n},~~b\isin \mathbb{R}^m$【就是f可以表达为一个线性变换的形式

若$S\isin \mathbb{R}^n$为凸，$f:\mathbb{R}^n \rightarrow \mathbb{R}^m$仿射，则$f(S)=\{f(x)|x\isin S\}$为凸。【一个凸集的仿射也仍然是凸集

仿射的逆的映射也仍保证凸集的凸性：

$g:\mathbb{R}^k \rightarrow \mathbb{R}^n, g^{-1}(x) = \{x|g(x)\isin S\}$，$g^{-1}(x)$就是仿射的逆的映射。【因为两边都是线性的变换，可逆的要求是A需要时列满秩矩阵



######  缩放和移位

缩放和移位可以保持凸性的，都是仿射的映射

缩放：$\alpha S = \{\alpha x |x \isin S\}$，显然可以保持凸性

移位：$ S+a = \{x+a |x \isin S\}$，显然可以保持凸性



###### 例：两个凸集的和是凸的

【集合的和：$S_1+S_2=\{x+y|x\isin S_1,~~ y \isin S_2\}$

证明：

下面自定义的一个集合也是凸的：

定义集合$S_1 \times S_2=\{(x,y)|x\isin S_1,~~ y \isin S_2\}$

那么定义一个线性映射$f(x,y)=x+y$，那么对集合$S_1 \times S_2$进行线性映射，就会得到两个集合的和，这样他们一定是一个凸集。



###### 例：线性矩阵不等式 LMI

$A(x)=x_1A_1+...+x_nA_n \le B,~~ B,A_i,x_i \isin S^m$

【这里的$\le$表示的应该是$(A(x)-B)\le0$是一个半负定的矩阵

线性矩阵不等式的解集$\{x|A(x)\le B\}$也仍然是凸集

证明：

定义仿射变换$f(x)\triangleq B-A(x)$【从一个n维空间向一个m维空间的变换

从上文知，$\mathbb{S}_{+}^n$为凸，

则有逆映射
$$
f^{-1}(\mathbb{S}_+^n)=\{x|B-A(x)\ge 0\}
$$
【相当于说是，利用这个仿射变换将目标集合和一个半正定的凸集联系到了一起，这样通过仿射变换的性质就可以得到目标集合是半正定的的结论了。



###### 例：椭球是球的仿射映射

有椭球
$$
\epsilon(x_c,r,P) =\{x|(x-x_c)^TP^{-1}(x-x_c)\le 1\},P\isin S_{++}^n
$$
有单位球
$$
\{u|\Vert u \Vert_2 \le 1\}
$$
考虑一个作用于球的仿射映射
$$
f(u)=P^{\frac{1}{2}}u+x_c
$$

$$
\{f(u)|\Vert u\Vert_2\le 1\}=\{P^{\frac{1}{2}}u+x_c|\Vert u\Vert_2\le 1\}
$$

令$x\triangleq P^{\frac{1}{2}}u+x_c$，则有$u=P^{-\frac{1}{2}}(x-x_c)$，回带得：
$$
\{x|\Vert P^{-\frac{1}{2}}(x-x_c)\Vert_2 \le 1\}=\{x|(x-x_c)^TP^{-1}(x-x_c)\le 1\}
$$


##### 3.3 透视函数 perspective function

$$
P,~~\mathbb{R}^{n+1}\rightarrow\mathbb{R}^{n}
$$

n+1维映射到n维【降一维的函数，

P的定义域是$dom~~P=\mathbb{R}^n\times \mathbb{R}_{++}$【就是说，前n维是在n维实数空间内的，最后一维则一定要是一个正的实数

###### 定义：

$$
P(z,t)=\frac{z}{t},~~z\isin \mathbb{R}^n,~~t\isin\mathbb{R}_{++}
$$

【假设有一个n+1维的向量(z,t)，最后一维是一个正数，那么一个就让前z个元素分别除以这一个t然后扔掉t就得到了结果。

【被称为**透视函数**，有一个小孔成像的例子，相当于把一个实像映射到一个幕布上，将距离维度抹除了。

###### 性质：

任意的一个凸集，经过一个透视函数后，仍然是一个凸集



###### 例：考虑$\mathbb{R}^{n+1}$内线段，这一线段经过透视函数后，仍然是一个凸集，而且仍是一个线段

$x = (\tilde{x}, x_{n+1}),~~ x \in \mathbb{R}^n,~~x_{n+1} \in \mathbb{R}_{++}$

$y = (\tilde{y}, y_{n+1}),~~ y \in \mathbb{R}^n,~~y_{n+1} \in \mathbb{R}_{++}$

$\theta \ge 0$，线段为$\theta x+(1-\theta)y$

证明：

映射后$x\overset{P}{\rightarrow}P(x)$，$y\overset{P}{\rightarrow}P(y)$

对于$\theta x+(1-\theta)y \overset{P}{\rightarrow} P(\theta x+(1-\theta)y)$
$$
P(\theta x+(1-\theta)y)=\frac{\theta\tilde{x}+(1-\theta)\tilde{y}}{\theta x_{n+1}+(1-\theta)y_{n+1}}
\newline
=\frac{\theta x_{n+1}}{\theta x_{n+1}+(1-\theta)y_{n+1}}\frac{\tilde{x}}{x_{n+1}}+\frac{\theta y_{n+1}}{\theta x_{n+1}+(1-\theta)y_{n+1}}\frac{\tilde{y}}{y_{n+1}}
$$
令：
$$
\mu=\frac{\theta x_{n+1}}{\theta x_{n+1}+(1-\theta)y_{n+1}},则 1-\mu=\frac{\theta y_{n+1}}{\theta x_{n+1}+(1-\theta)y_{n+1}}
$$
则有：
$$
P(x)=\frac{\tilde{x}}{x_{n+1}},~~P(y)=\frac{\tilde{y}}{y_{n+1}}
$$
则有：
$$
P(\theta x+(1-\theta)y)=\mu P(x)+(1-\mu)P(y)
$$
但注意到以上情况中$\theta$变化时，$\mu$就会随之变化，新的凸组合的位置就会发生改变。这样如果$\theta$和$\mu$是一个**一一映射**（显然），那么就可以保证是从一个线段映射成另一个线段。

【可以表达为一个线性凸组合，从一个n+1维的线段映射到另一个n维的线段



###### 任意凸集的反透视映射仍然是凸集

反透视映射【低维向高维：
$$
P^{-1}(C)=\{(x,t)\in \mathbb{R}^{n+1}|\frac{x}{t}\in C,~~t\ge 0\}
$$
考虑$(x,t)\in P^{-1}(C), ~~(y,s)\in P^{-1}(C),~~ 0\le \theta \le 1$

则有两点的凸组合：
$$
(\theta x+(1-\theta)y,\theta t+(1-\theta)s)
$$
那么判断其是否是凸集，就要判断凸组合是否仍在集合C中，即
$$
\frac{\theta x+(1-\theta)y}{\theta t+(1-\theta)s}~~ is~ \in C ??
$$
可以推出：
$$
\frac{\theta t}{\theta t+(1-\theta)s}\frac{x}{t}+(1-\frac{\theta t}{\theta t+(1-\theta)s})\frac{y}{s}
$$
分别对应为$\mu, ~~ C中一点, ~~(1-\mu),~~C中一点$，因为C是凸集，则其必然在C中，证必



##### 3.4 线性分数函数

仿射和透视的组合

###### 定义：

$g: \mathbb{R}^n \rightarrow \mathbb{R}^{m+1}$ 为仿射映射

$g(x) = \left[ \begin{array}{c}
A \\
C^{\intercal} 
\end{array} \right] x + \left[ \begin{array}{c}
b \\
d 
\end{array} \right]$

$A \in \mathbb{R}^{m \times n}, \quad b \in \mathbb{R}^m$

$C \in \mathbb{R}^n, \quad d \in \mathbb{R}$



$P: \mathbb{R}^{m+1} \rightarrow \mathbb{R}^{m}$为透视函数

那么组合为：
$$
f: \mathbb{R}^n \rightarrow \mathbb{R}^{m} \triangleq P \circ g
\newline
f(x) = \frac{Ax+b}{C^Tx+d}
\newline
\text{dom}_f = \{ x \mid C^Tx + d \geq 0 \}
$$
这样的f就是一个**线性分数函数**，两个操作都是**保凸的**，虽然两个线性变换组合为了一个非线性变换，但他仍然是保凸的。

【虽然$f(x)$是非线性的，但他仍是**拟凸（见9）的好函数！！！**

###### 例：两个随机变量的联合概率$\rightarrow$条件概率的映射

假设有两个随机变量，取值1~n的u和取值1~m的v，其联合概率为：
$$
P_{ij}=P(u=i,v=j)
$$
其条件概率为：
$$
f_{ij}=P(u=i|v=j)
$$


有关系：
$$
f_{ij}=\frac{P_{ij}}{\sum_{k=1}^n{P_{kj}}}
$$
可以把他想象为：

- 分母：给定j后，向量$[P_1j~~~...~~~P_kj]$的线性组合（求和）
- 分子：给定i后，向量$[P_1j~~~...~~~P_kj]$与一个$[0~~~...~~~1~~~...0]$（第i位是1，其余是0）的线性组合

这样他就变成了一个**保凸的线性分数函数**

#### 4. 凸函数的定义和扩展

##### 4.1 凸函数

###### 定义1：

$f:\mathbb{R}^n \rightarrow \mathbb{R}$为凸$\Leftrightarrow$dom f为凸

- 【**定义域一定是一个凸集**】，
- 且对所有的$x,y \in dom f, ~~0\le\theta\le 1,$有$f(\theta x+(1-\theta)y)\le \theta f(x)+(1-\theta)f(y)$

【凹函数第二点相反

凸组合的函数值一定小于等于函数值的凸组合

###### 定义2：

$f:\mathbb{R}^n \rightarrow \mathbb{R}$为凸$\Leftrightarrow$dom f为凸【定义域一定是一个凸集】，且对所有的$x \in dom f, v\in \mathbb{R}^n,g(t)=f(x+tv)$为凸，此处有$dom g=\{t|x+tv\isin dom f\}$

【切西瓜】【将高维的复杂问题降低到低维上



##### 4.2 凸函数的拓展

有凸函数$f:\mathbb{R}^n \rightarrow \mathbb{R}$为凸，$domf=C\in \mathbb{R}^n$

对这个凸函数进行扩展，得到$\tilde{f}$，那么拓展是否是凸函数呢？

$\tilde{f} = \left\{ \begin{array}{ll} f(x) & \text{if } x \in \text{dom} f \\ +\infty & \text{if } x \notin \text{dom} f \end{array} \right.$

$\tilde{f}:\mathbb{R}^n \rightarrow \mathbb{R},dom\tilde{f}\in \mathbb{R}^n$

- 首先定义域满足凸集的条件
- 也一定满足不等式条件

那么$\tilde{f}$也是凸函数



###### 例：示性函数是凸函数

示性函数（Indicator Function），也称为特征函数或指示函数，是一个简单的函数，用于表明某个给定的属性是否为真。

有凸集 $C\subseteq \mathbb{R}^n$，那么他的一个简单的示性函数为$f_c(x) = \left\{ \begin{array}{ll} 无定义 & x \notin C \\ 0 &  x  \isin C \end{array} \right.$

显然是一个凸函数。

扩展到n维空间后，$I_c(x) = \left\{ \begin{array}{ll} 无定义 & x \notin C \\ 0 &  x  \isin C \end{array} \right.$

显然也是一个凸函数。【他说解释了但那节课9缺了

对于函数$J_c(x) = \left\{ \begin{array}{ll} 0 & x \notin C \\ 1 &  x  \isin C \end{array} \right.$  ，这个函数既不凸也不凹。



##### 4.3 一阶条件

设$f:\mathbb{R}^n \rightarrow \mathbb{R}$可微，即梯度$\nabla f$在 $dom f$上均存在（隐含了domf一定是一个开集的条件，没有边界），则$f$为凸等价于

- $domf$为凸
- $f(y) \ge f(x)+\nabla f^T(x)(y-x),~~\forall x,y \isin domf$
  - 即在$x$点沿着$x$位置的切线方向攀登$y-x$的横坐标，无法达到$f(y)$的位置，切线永远低于对应的高度

###### 证明：

考虑一维情况：

$f$为凸，$\forall x,y\isin domf$为凸

一定满足$\forall t ,~~0<t\le 0,~~x+t(y-x)\isin domf$ (就是一个凸组合)

证充分（用凸函数定义证导数不等式）：

$f(x+t(y-x))\le (1-t)f(x)+tf(y)$

$\Rightarrow tf(y)\ge tf(x)+f(x+t(y-x))-f(x)$

$\Rightarrow f(y)\ge f(x)+\frac{f(x+t(y-x))-f(x)}{t}$

取极限$\underset{t\rightarrow 0_+}{lim}$，则右侧的分式得到$\nabla f^T(x)(y-x)$（通过泰勒展开，或者在分母加上y-x也是无穷小量），得到

$f(y) \ge f(x)+ f'(x)(y-x)$

证必要（用导数不等式证凸函数定义）：

设$\forall x \ne y,~~x,y\isin domf,~~0\le\theta\le1$构造$z=\theta x +(1-\theta)y ~\isin domf$

把$x,y,z$用到上面刚刚证好的式子中，得到

$f(x) \ge f(z) +f'(z)(x-z)$

$f(y) \ge f(z) +f'(z)(y-z)$

对$f(x),f(y)$进行凸组合：

$\theta f (x)+(1-\theta)f(y) \ge f(z) +(\theta(x-z)+(1-\theta)(y-z))f'(z)$

通过$z$的定义可以化0，得到

$\theta f (x)+(1-\theta)f(y) \ge f(z) $



考虑高维情况【用到凸函数定义2：

证充分（用凸函数定义证导数不等式）：

设$f$为凸，考虑$x,y\in dom~f$

构造$g(t)=f(ty+(1-t)x)=f(x+t(y-x))$（f内是对x和y的一个仿射组合)

这样就构造出了一个定义2的形式

此时：

$g'(t)$是一个一维的函数
$$
g'(t)=\nabla f^T(ty+(1-t)x)(y-x)
$$
那么一个凸函数必然满足如下性质：
$$
g(t_1)\ge g(t_2)+g'(t_2)(t_1-t_2)
$$
那么我取$t_1=1,~~t_2=0$，式子也一定成立
$$
g'(1)\ge g(1)+g'(0
)
$$
因此根据g的定义，有：
$$
f(y)\ge f(x) +\nabla f^T(x)(y-x)
$$
证毕



证必要（用导数不等式证凸函数定义）：

$$\forall x,y ~~ \in domf$$
$$
ty+(1-t)x \in domf
\newline
\tilde{t}y +(1-\tilde{t})x \in domf
$$


带入导数不等式：
$$
f(ty+(1-t)x )\ge f(\tilde{t}y +(1-\tilde{t})x) + \nabla f^T(\tilde{t}y +(1-\tilde{t})x)(ty+(1-t)x -\tilde{t}y -(1-\tilde{t})x)\newline
f(ty+(1-t)x )\ge f(\tilde{t}y +(1-\tilde{t})x) + \nabla f^T(\tilde{t}y +(1-\tilde{t})x)(y-x)(t -\tilde{t})
$$
构造函数：
$$
g(t)=f(ty+(1-t)x)\newline
g(\tilde{t})=f(\tilde{t}y+(1-\tilde{t})x)
$$
根据前面的不等式，可以得出：
$$
g'(\tilde{t})=\nabla f^T(\tilde{t}y+(1-\tilde{t})x)(y-x)
\newline
$$
带入到上述很长的那个不等式：
$$
g(t)\ge g(\tilde{t})+g'(\tilde{t})(t-\tilde{t})
$$
利用一维情况下的结论，就可以得出$g(t)$是凸函数。进而$f$也就是凸函数了。



凸函数有，一阶条件，**即偏导为0时，凸函数可以取到极值**：

若$\nabla^Tf(x)=0$则$\forall y,~~f(y)\ge f(x)$



##### 4.4 二阶条件【更常用

若$f:\mathbb{R}^n \rightarrow \mathbb{R}$二阶可微，则$f$为凸等价于：

- $domf$为凸，$\nabla^2 f(x) \ge0,~~ \forall x \in domf$



$\nabla^2 f(x)$叫做Hessian矩阵，是一个半正定的矩阵。

Hessian矩阵半正定，就是说明一个函数的一阶偏导**单调不减**，想象一个始终向上弯曲的锅形，可以回想起一阶条件



$\nabla^2 f(x)>0$，是一个正定矩阵的话$\Rightarrow f$是严格凸的函数

- 反过来不成立！比如$f(x)=x^4$



###### 例：二次函数$f:\mathbb{R}^n \rightarrow \mathbb{R}, ~~domf=\mathbb{R}^n$

$f(x) = \frac{1}{2}x^TPx+q^Tx+r,~~P\in \mathbb{S}^n,~~q\in\mathbb{R}^n, r\in\mathbb{R}$

这样一个函数，什么条件下是凸函数，什么条件下是凹函数?

直接计算Hessian矩阵！

$\nabla^2 f(x)=P$

根据矩阵P是正定负定就可以判断凹凸性



###### 例：$f(x)=\frac{1}{x^2}, ~~x\ne 0, x\isin \mathbb{R}$

同样的问题，$f''(x)=6x^{-4}$

可以发现，他虽然满足Hessian矩阵的条件，但**定义域不是凸集！**



##### 4.5 常见函数的凸性

###### 仿射函数

$f(x)=Ax+b$，是凸的【用二阶条件$\nabla^2f(x)=0$，又是凹又是凸



###### 指数函数

$f(x)=e^{ax},~~x\in\mathbb{R}$

是凸函数

- 二阶条件下$f''(x)=a^2e^{ax}$

###### 幂函数

$f(x)=x^a,~~x\in\mathbb{R}_{++}$

- 二阶条件下$f''(x)=a(a-1)x^{a-2}$
  - $\nabla^2f(x)=\left\{ \begin{array}{ll} \geq 0 & \text{if } a \ge1 ~or~a\le 0 \\ \leq 0 & \text{if } 0 \leq a \leq 1 \end{array} \right.$
  - 等于1时相当于一个仿射函数
  - 等于0时是一个常数



###### 绝对值的幂函数

$f(x)=|x|^p,~~x\in\mathbb{R}$（$p\ne -1$）

$f'(x)=\left\{ \begin{array}{ll} px^{p-1} & \text{if } x\ge0 \\ -p(-x)^{p-1} & \text{if } x<0 \end{array} \right.$

$f''(x)=\left\{ \begin{array}{ll} p(p-1)x^{p-2} & \text{if } x\ge0 \\ p(p-1)(-x)^{p-2} & \text{if } x<0 \end{array} \right.$

$p>1$时，满足二阶条件，原函数为凸函数

但当$p=1$时，他虽然不满足二阶条件，但满足凸函数的定义

因此$p\ge1$时都是凸函数，但其实只有$p\ge2$时才能用二阶条件说明凸性，否则$1<p<2$时不是二阶可微，不能直接用二阶条件得到凸性



###### 对数函数

$f(x)=log(x), ~~x\in \mathbb{R}_{++}$

$f'(x)=\frac{1}{x}$

$f''(x)=-\frac{1}{x^2}$

是一个严格凹的函数



###### 负熵

$f(x)=xlog(x),~~x\in \mathbb{R}_{++}$

$f'(x)=log(x)+1$

$f''(x) = \frac{1}{x}$

由于x的定义域为$\mathbb{R}_{++}$，则其二阶导必然大于0，负熵函数为严格凸的



为什么要最大化一个熵呢？因为最大化一个熵相当于最小化一个负熵，而负熵是一个凸函数，求凸函数的极小值是一个容易的问题



###### 范数

$\mathbb{R}^n$空间内的范数$P(x),~~ x\in \mathbb{R}^n$

其中范数满足的条件为 【齐次，非负，三角不等式】：

- $P(ax)=|a|P(x)$
- $P(x+y)\le P(x)+P(y)$
- $P(x)=0 \Leftrightarrow x=0$



证明：

$\forall x,y \in \mathbb{R}^n, \forall 0\le \theta\le 1$

有凸组合的范数，用三角不等式和用范数满足的第一个等式

$P(\theta x+(1-\theta)y)\le P(\theta x)+P((1-\theta)y)=\theta P(x)+(1-\theta)P(y)$

符合凸函数定义1



###### 零范数

$\Vert x\Vert _0$ 相当与统计x中非0元素的总和

【0范数其实并不是一个范数



###### 极大值函数

$f(x)=max\{x_1,...,x_n\},~~x\in \mathbb{R}^n$

$\forall x,y \in \mathbb{R}^n,~~0\le\theta\le1$

$f(\theta x+(1-\theta)y)=max\{\theta x_i+(1-\theta y_i,~~i=1,...,n\}\newline\le\theta max\{x_i,~~i=1,...,n\}+(1-\theta)max\{y_i,~~i=1,...,n\}\newline=\theta f(x)+(1-\theta)f(y)$



极小极大问题【求一些极大值的极小值】实际上也是凸问题，因为我们的极大值函数是凸函数，因此求极大值函数的极小值是容易的
$$
\underset{x}{min}~\underset{y}{max}~f(x,y)
$$
但随之而来的一个问题，就是极大值函数没办法求导。因此会采取一个**解析逼近**的办法求导

**log-sum-up 函数【凸】**
$$
f(x)=log(e^{x_1}+...+e^{x_n}),~~x\in \mathbb{R}^n
$$
而这个函数一定满足以下不等式：
$$
max\{x_1,...,x_n\}\le f(x)\le max\{x_1,...,x_n\}+log(n)
$$
逼近的误差不大于$log(n)$

对log-sum-up 求Hessian矩阵验证二阶条件：

一阶导【就是softmax函数】：
$$
\frac{\partial f}{\partial x_i} = \frac{e^{x_i}}{e^{x_1} + \ldots + e^{x_n}}
$$
Hessian矩阵中的元素$H_{ij}$是先对元素i求偏导，再对元素j求偏导

$i\ne j$时，二阶导：
$$
\frac{\partial^2 f}{\partial x_i\partial x_j} = \frac{-e^{x_i}e^{x_j}}{(e^{x_1} + \ldots + e^{x_n})^2}
$$
$i=j$时，二阶导：
$$
\frac{\partial^2 f}{\partial x_i \partial x_j} = \frac{-e^{x_i} e^{x_k} + e^{x_i}\left( e^{x_1} + \ldots + e^{x_n} \right)}{\left( e^{x_1} + \ldots + e^{x_n} \right)^2}
$$


Hassien矩阵可以写作：


$$
H = \frac{1}{\left(e^{x_1} +...+ e^{x_n}\right)^2}
\{
\begin{bmatrix}
e^{x_1} \left( e^{x_1} +\dots+ e^{x_n} \right) && 0 \\
&\ddots
\\
0& & e^{x_n} \left( e^{x_1} +\dots+ e^{x_n} \right)
\end{bmatrix}
-
\left[
\begin{array}{c}
e^{x_1} \\
\vdots
\\
e^{x_n}
\end{array}
\right]
\left[
\begin{array}{cc}
e^{x_1} &\dots& e^{x_n}
\end{array}
\right]\}
$$


大括号内前面的大矩阵一定是正定的，对角线元素就是特征值同时也是奇异值。

定义：

$z=[e^{x_1} \dots ~e^{x_n}]^T$

将Hassien矩阵简化为:
$$
H=\frac{1}{(\mathbb{1}^Tz)^2}((\mathbb{1}^Tz)diag\{z\}-zz^T)
$$


不用考虑括号前的，必大于0，只需要验证$K=(\mathbb{1}^Tz)diag\{z\}-zz^T$

为了验证这个矩阵，有对于$\forall v \in \mathbb{R}^n, ~~v^TKv\ge 0$
$$
v^TKv=(\mathbb{1}^Tz)v^Tdiag\{z\}v-v^Tzz^Tv=(\sum_iz_i)(\sum_iv_i^2z_i)-(\sum_iv_iz_i)^2
$$
定义向量$a_i=v_i\sqrt{z_i},~~b_i=\sqrt{z_i}$

带入可得：
$$
=(b^Tb)(a^Ta)-(a^Tb)^2
$$
由于Cachy-Schwartz不等式，则必有：
$$
(b^Tb)(a^Ta)-(a^Tb)^2\ge0
$$
证毕



###### 几何平均

$f(x)=(x_1\times...\times x_n)^{\frac{1}{n}},~~x\in\mathbb{R}^n_{++}$

他是一个凹函数，不是一个凸函数



###### 行列式的对数

$f(x)=log~det(x),~~domf=\mathbb{S}^n_{++}$

首先$x$是一维时，一定是一个凹函数（log）

当$n>1$时，对$\forall z \in \mathbb{S}^n_{++},~~\forall t\in\mathbb{R},~~\forall v\in\mathbb{R}^{n\times n}$

$z+tv\in \mathbb{S}^n_{++}=domf$，故$v\in \mathbb{S}^{n\times n}$

$g(t)=f(z+tv)=log~det(z+tv)\newline=log~det\{z^{\frac{1}{2}}(I+tz^{-\frac{1}{2}}vz^{-\frac{1}{2}})z^{\frac{1}{2}})\}\newline=log~det\{z\}+log~det\{I+tz^{-\frac{1}{2}}vz^{-\frac{1}{2}}\}\newline=log~det\{z\}+\sum_{i=1}^nlog(1+t\lambda_i)$

其中$\lambda_i$为$z^{-\frac{1}{2}}vz^{-\frac{1}{2}}$的第$i$个特征值。而由于这个矩阵是一个对称的矩阵，那么一定可以对这个矩阵进行特征值分解：

$tz^{-\frac{1}{2}}vz^{-\frac{1}{2}}=QAQ^T,~~QQ^T=I,~~A$是对角阵，特征值与原矩阵特征值相等，$Q$是单位正交矩阵
$$
det(I+tz^{-\frac{1}{2}}vz^{-\frac{1}{2}})=det(QQ^T+QAQ^T)=det(Q)det(I+A)det(Q^T)=det(QQ^T)det(I+A)=det(I+A)=\sum_{i=1}^n(1+t\lambda_i)
$$

$$
g'(t)=\sum_i\frac{\lambda_i}{1+t\lambda_i}
\newline
g''(t)=\sum_i\frac{-\lambda_i^2}{(1+t\lambda)^2}\le0
$$

这样函数$g$一定是一个凹函数，所以函数$f$是一个凸函数



#### 5. 凸函数的保凸操作

##### 5.1 非负加权和

$f_1,...,f_m$为凸，则$f=\sum^m_{i=1}w_if_i$为凸，其中$\forall i，~~w_i\ge0$

证明：

- 显然定义域是凸的
- 显然满足定义1的不等式



若$f(x,y)$（不一定是一个凸函数）对$\forall y \in A,~~f(x,y)$均为凸函数，【相当于对于$(x,y)$ jointly convex 情况下，‘边缘凸’的

设$w(y)\ge0,~~\forall y \isin A$

那么有**非负加权和的积分形式**

$g(x)=\int_{y\in A}w(y)f(x,y)dy$为凸

##### 5.2 仿射映射

$f:\mathbb{R}^n\rightarrow\mathbb{R},~~A\in \mathbb{R}^{n\times m},~~b\in\mathbb{R}^n$

$g(x)=f(Ax+b),~~domg=\{x|Ax+b\in domf\}$ 仍能保持凸性

证明：

令$x,y\in domg,~~0\le\theta\le1$

$g(\theta x+(1-\theta)y)=f(\theta Ax+(1-\theta)Ay+b)=f(\theta(Ax+b)+(1-\theta)(Ay+b))\newline\le\theta f(Ax+b)+(1-\theta)f(Ax+b)=\theta g(x)+(1-\theta)g(y)$

证毕



换一种表达方式，类比加权和函数：

$f_i:\mathbb{R}^n\rightarrow\mathbb{R}，~~i=1,...,m$为凸，$A\in\mathbb{R}^{m},~~b\in\mathbb{R}$

定义一个仿射变换$g(x)=A^T[f_1(x)~~...~~f_m(x)]^T+b$

这样只有在对A是半正定的情况下，g才是凸的，**看非负加权和定义！**



##### 5.3 两个函数的极大值函数

$f_1,f_2$为凸，定义$f(x)=max\{f_1(x),f_2(x)\},~~domf=domf_1 \cap domf_2$，则$f(x)$一定是凸的

设$x,y\in domf,~~0\le\theta\le1$

$f(\theta x+(1-\theta)y)=max\{f_1(\theta x+(1-\theta)y),f_2(\theta x+(1-\theta)y)\}$

用凸函数定义1，有

$\le max\{\theta f_1(x)+(1-\theta)f_1(y),\theta f_2(x)+(1-\theta)f_2(y)\}$

利用了max操作的不等式

$\le max\{\theta f_1(x),\theta f_2(x)\}+max\{(1-\theta)f_1(y),(1-\theta)f_2(y)\}$

这样可以把系数提出来，不等式右边就等于

$=\theta f(x)+(1-\theta)f(y)$



推广到n个函数的极大值函数也仍是凸的【无限时求和为积分 极大为sup 上确界：

$f(x,y)$对于$x$为凸，$\forall y\isin A$，$g=\underset{y\isin A}{sup}f(x,y)$ 为凸





###### 例：向量中r个最大元素的和

设$x[i]$是第$i$大的元素

排序，使得

$x[1]\ge...\ge x[r]...\ge x[n]$

则有$f(x)=\sum_{i=1}^rx[i]$

他可以写成如下形式：

$f(x)=max\{x_{i1}+...+x_{ir}|1\le i_1\le...\le i_r\le n\}$，一共有$C_n^r$种选择

首先max大括号内的是一个对于向量$x$的仿射映射，共有$C_n^r$个仿射的映射，那么就相当于5.3的推广，即在$C_n^r$个凸函数的极大值函数，则一定是凸函数



###### 例：实对称矩阵的最大特征值

$f(x)=\lambda_{max}(x),~~domf=\mathbb{S}^m$

对于特征值$xy=\lambda y$时，x为特征向量，$\lambda$为特征值

那么两边左乘$y^T$，有$y^Txy=\lambda \Vert y\Vert^2_2$

$\lambda=\frac{y^Txy}{\Vert y\Vert^2_2}$

由于特征向量和特征值与$y$无关，因此设$\Vert y\Vert_2=1$，有$\lambda=y^Txy$

带入原函数
$$
f(x)=\lambda_{max}(x)=sup\{y^Txy|\Vert y\Vert_2=1\}
$$
考虑到$y^Txy$是关于$x$的线性变换，因此一定是凸函数



##### 5.4 函数的组合

$h:\mathbb{R}^k\rightarrow \mathbb{R},~~g:\mathbb{R}^n\rightarrow \mathbb{R}^k$

则有函数组合$f=h\circ g:\:\mathbb{R}^k\rightarrow \mathbb{R}$

相当于$f(x)=h(g(x))$【复合函数

那么这个函数的定义域为：$domf=\{x\isin domg|g(x)\isin domh\}$



###### 一维的情况：

$k=n=1,~~domg=domf=domh=\mathbb{R},$ 且h，g均是二阶可微的

这样$f$为凸的条件$\Leftrightarrow$$f''(x)\ge0$

$f'(x)=h'(g(x))g'(x)$

$f''(x)=h''(g(x))g'(x)^2+h'(g(x))g''(x)$

要想让上式大于等于0，则：

- $h$为凸，不降，$g$为凸，则$f$为凸
- $h$为凸，不增，$g$为凹，则$f$为凸
- $h$为凹，不降，$g$为凹，则$f$为凹
- $h$为凹，不增，$g$为凸，则$f$为凹

###### 高维的情况：

$n,k\ge1,~~domg,~~domh,~~domf\ne \mathbb{R}^n~\mathbb{R}^k~\mathbb{R}^n$

且$h,g$均不二阶可微

【如果一个函数的定义域只是定义域中的一部分，一般便于分析，会对函数保证凹凸性的情况下对其进行一定的扩展，使其扩展到全部空间中，便于分析

例如对于$h(x)=logx$，将其扩展为：

$\tilde{h}(x)=\left\{ \begin{array}{ll}-logx&x>0\\+\infin&x\le0 \end{array}  \right.$

这样扩展到了全体定义域，并且满足了凸性

有如下性质：

- $h$为凸，$\tilde{h}$不降，$g$为凸，则$f$为凸
- $h$为凸，$\tilde{h}$不增，$g$为凹，则$f$为凸
- $h$为凹，$\tilde{h}$不降，$g$为凹，则$f$为凹
- $h$为凹，$\tilde{h}$不增，$g$为凸，则$f$为凹



证明第一条：

利用凸函数的定义一

选择两点$\forall x,y \in domf,~~0\le\theta\le 1$

已知$g$为凸函数，故$domg$为凸。根据$f$的构成，一定有$x,y\in domg,g(x),g(y)\in domh$

$\theta x +(1-\theta)y \in domg$

故根据凸函数定义一有：

$g(\theta x(1-\theta)y)\le\theta g(x)+(1-\theta)g(y)$



已知$h$为凸函数，故$domh$为凸。

$\theta g(x) +(1-\theta)g(y) \in domg$

故根据凸函数定义一有：

$h(\theta g(x)(1-\theta)g(y)\le\theta h(g(x))+(1-\theta)h(g(y))=\theta f(x)+(1-\theta)f(y)$

当不等式左侧$\ge f(\theta x+(1-\theta )y)=h(g(\theta x+(1-\theta )y))$时，则$f$就一定满足了凸函数定义

但根据上面的问题，$g(\theta x+(1-\theta )y)$不一定在$domh$之中，不能简单的利用$h$的单调性来证明



这样有子问题：

证明：$g(\theta x+(1-\theta )y)\in domh$

利用反证：假如$g(\theta x+(1-\theta )y) \notin domh$

这样利用了$h$的扩展$\tilde{h}$，他是一个不降的函数

那么有$\tilde{h}(g(\theta x+(1-\theta )y))\le \tilde{h}(\theta g(x)+(1-\theta)g(y))$

因为假设了$g(\theta x+(1-\theta )y)$不在$h$的定义域中，根据扩展的结果，有$\tilde{h}(+\infin)\le \tilde{h}(\theta g(x)+(1-\theta)g(y))$，那么$\tilde{h}$只能是一个处处正无穷的函数。我们不考虑这类函数的存在【？？？不懂不理解

这样就可以证明$g(\theta x+(1-\theta )y)$在$domh$之中

进而就可以用$h$​的单调性和$g(\theta x(1-\theta)y)\le\theta g(x)+(1-\theta)g(y)$证明$f$的凸性



###### 应用例子

例：若$g$为凸，$exp\{g(x)\}$为凸

此时$h(z)=exp(z)$，这样满足性质1，组合后的函数也为凸



若$g$为凹，$g>0,~~log\{g(x)\}$为凹

此时$h(z)=log(z)$为凹，扩展为

$\tilde{h}(x)=\left\{ \begin{array}{ll}logx&x>0\\-\infin&x\le0 \end{array}  \right.$，不降

此时符合第三条性质，组合后的函数为凹函数



【**抽象！！说不需要记住，要用的时候翻书**



例：若$g$为凹，$g>0$,$\frac{1}{g(x)}$为凸

有$h(z)=\frac{1}{z}$

这样可以用上第二条性质



例：若$g$为凸，$g\ge 0,p\ge 1,g^p(x)$为凸

对于$h(z)=z^p，~~domh=\mathbb{R}_{+}$

这样的情况下，对其进行扩展就会发现$\tilde{h}$失去了单调性。

那么重新构建一个$h(z)=\left\{ \begin{array}{ll} z^p&z\in\mathbb{R}_+ \\0&z\in\mathbb{R}_{--} \end{array} \right.$

就可以了【我踏马自己扩展





例：($\tilde{h}$的单调性)

$g(x)=x^2,~~domg\in \mathbb{R}$是凸的

$h(z)=0,~~domh=[1,2]$为凸，且定义域内是单调（不增不降）的

现在考虑函数$f=h(g(x))$，如果不考虑对其进行扩展，$f$是既不凸又不凹的，这样是不符合结论的。而一旦对其进行扩展，会发现$\tilde{h}$是没有单调性的，无法满足任何一个规则





#### 6. 函数的透视

注意和透视函数是不一样的

定义：

有映射$f:\mathbb{R}^n\rightarrow\mathbb{R},~~g:\mathbb{R}\times \mathbb{R}_{++}\rightarrow \mathbb{R}$

$g(x,t)=tf(\frac{x}{t})$

由n+1维降到1维

有$domg=\{(x,t)|t>0,~~\frac{x}{t}\in domf\}$

那么有性质$f$为凸，$g$为凸；$f$为凹，$g$为凹

要注意，要同时考虑$(x,t)$同时凸组合，而不能分别做凸组合

并考虑$g$对于$(x,t)$是 jointly convex 联合凸



例：欧几里得范数的平方，$f(x)=x^Tx, domf\isin\mathbb{R}^n$

$g(x,t)=t(\frac{x}{t})^T(\frac{x}{t})=\frac{x^Tx}{t}$

有意思的点在于$x^Tx$单独看是凸的，考虑$t$的定义域，$\frac{1}{t}$也是凸的，而组合在一起还是凸的



例：负的对数 $f(x)=-log(x),~~domf =\mathbb{R}_{++}$

$g(x,t)=t(-log\frac{x}{t})=tlog\frac{t}{x},~~domg=\mathbb{R}^2_{++}$，是凸的【函数$g$称为关于$t$和$x$的相对熵

考虑$u,v\isin R^n_{++}$，

有$g(u,v)=\sum_{i=1}^nu_ilog\frac{u_i}{v_i}$，也是凸的，【不能直接用非负加权和，因为非负加权和要求其自变量是同一个【老师说相当于把$u$和$v$分成n份不相关的变量，然后是这些变量构成的函数都是凸的，最后加和在一起也是凸的？

证明看这个https://blog.csdn.net/qqzqf1998/article/details/121242506



再进行一下变化

$D_{KL}(u,v)\triangleq \sum_{i=1}^n(u_ilog\frac{u_i}{v_i}-u_i+v_i)$，是凸的【KL散度

扩展 Bregman Divergence【不一定为凸：

$f:\mathbb{R}\rightarrow \mathbb{R}$为凸

$D_B(u,v)\triangleq f(u)-f(v)-\nabla f(v)(u-v)$

可以退化为DL散度



#### 7. 函数的共轭/Fenchel对偶 conjugate

$f:\mathbb{R}^n\rightarrow \mathbb{R},~~f^*:\mathbb{R}^n\rightarrow \mathbb{R}$

有$f^*(y)=\underset{x\in domf}{sup}(y^Tx-f(x))$

注：一维下$yx$就是切线，高维下就是超平切面



##### 性质1:

若$f(x)$可微，则$f^*(y)$对应的$x$必是$f'(x)=y$的一点

换个角度，对于$x$要取最大值就是让$f^*(y)$对于$x$的偏导等于0



##### 性质2：

函数$f$的共轭$f*$一定为凸函数【不管原函数是否是凸都成立

因为共轭相当于，对于y的选取了无穷多个x的分段线性函数的极大值，也是凸的【考虑4.5内容



###### 求对偶例子

例: $f(x)=(Ax+b),~~domf\in\mathbb{R}$

$f^*(y)=\underset{x\in domf}{sup}((y-a)x-b)=\left\{ \begin{array}{ll}0&y=a\\+\infin&y\ne a \end{array}  \right.$



例:$f(x)=logx ,~~domf\in\mathbb{R}_{++}$

$f^*(y)=\underset{x>0}{sup}(yx-logx)$

对x求偏导，使偏导等于零，消去sup部分，因为sup都在偏导为0处取到，有$x=-\frac{1}{y}$，回带得

$\left\{ \begin{array}{ll}-1-log(-y)&y<0\\+\infin&y\ge0 \end{array}  \right.$



例：对于$f(x)=\frac{1}{2} x^TQx,~~Q\in\mathbb{S}_{++}^n,~~domf=\mathbb{R}^n$，凸函数

$f^*(y)=\underset{x\in domf}{sup}(y^Tx-\frac{1}{2} x^TQx)$

同样，对n维求x梯度，显然结果为y

$\frac{\partial}{\partial x} \left( y^T x - \frac{1}{2} x^T Q x \right) = y-Qx=0$

【注：对于列向量求偏导，相当于对列向量每个元素求一阶偏导

$\Rightarrow x=Q^{-1}y$

回带，得到

$f^*(y)=y^TQ^{-1}y-\frac{1}{2}y^TQ^{-1}y=\frac{1}{2}y^TQ^{-1}y$

【**很有趣的共轭结果！！**:lantern:



复数的共轭的共轭是自己，那么函数呢？

因为函数的共轭是凸函数，所以有:

- 若$f$非凸，则$f^{**}\ne f$【其实是他的‘最大包络凸函数’那种
- 若$f$为凸，而且是闭函数，那么有$f^{**}=f$



##### Fechel-Young 不等式

$$
f(x)+f^*(y)\ge y^Tx
$$

证明：
$$
f(x)+f^*(y)=f(x)+\underset{x'\in domf}{sup}(y^Tx'-f(x'))  \ge f(x) + y^Tx-f(x)=y^Tx
$$

注：还有一个从积分面积方面理解的概念

https://zhuanlan.zhihu.com/p/32202419


#### 8. 凸集与凸函数的关系

##### 8.1 下水平集

关键定义 $\alpha-sublevel ~set$ 下水平集：

若$f:\mathbb{R}^n\rightarrow \mathbb{R}$，定义其$\alpha-sublevel ~set$为

$C_\alpha =\{x\in domf|f(x)\le\alpha\}$

【注意这个集合是考虑自变量相关的



###### 性质：

凸函数的所有$\alpha-sublevel ~set$都是凸集



###### 证明：

$\forall x,y\in C_\alpha,~~f(x)\le\alpha,~~f(y)\le\alpha$

用凸函数定义1

$f(\theta x+(1-\theta)y)\le \theta f(x)+(1-\theta)f(y)\le \theta\alpha+(1-\theta)\alpha=\alpha$

有$\theta x+(1-\theta)y \in C_\alpha$

因此有$\alpha-sublevel ~set$都是凸集



但这一性质反过来不成立，则：

若函数的所有$\alpha-sublevel ~set$都是凸集，则$f$不一定是凸函数

考虑高维的情况，先从2维开始考虑：

对于$f:\mathbb{R}^2\rightarrow \mathbb{R}, x\in\mathbb{R}^2$

假设$f(x)=x^Tx$那么其实$C_\alpha$是一系列的以$\alpha$为半径的圆



#### 9. Quasi Convex Function/Unimodel function 拟凸函数/单模态函数

【若函数的所有$\alpha-sublevel ~set$都是凸集，则$f$不一定是凸函数】这种情况下的函数就是拟凸函数

定义：

$f:\mathbb{R}^2\rightarrow \mathbb{R}$

Quasi Convex: $S_\alpha=\{x=domf|f(x)\le \alpha\}$对于$\forall \alpha$全都是凸集

Quasi Concave：$S'_\alpha=\{x=domf|f(x)\ge \alpha\}$对于$\forall \alpha$全都是凸集

Quasi Linear：$S''_\alpha=\{x=domf|f(x)= \alpha\}$对于$\forall \alpha$全都是凸集

$e^x$同时是Quasi convex/concave/linear



##### 9.1 性质：

- 如果一个函数是凸函数，则他一定是一个拟凸函数，反过来则不一定对。

一个拟凸函数还可以是一个凹函数。



拟凸函数有另一个名字，是**单模态函数**。



很多问题如果是单模态函数，一般有对应的算法在多项式时间内解决。但通常因为他不是凸函数而无法理论分析

【所以是不是可以通过利用将某些部分**转化为单模态函数**的方法优化ML的计算？？

----



注：单模态函数和多模态函数的定义和区别

1. **单模态函数（Unimodal Function）**：
   - 这种函数在其定义域内只有一个局部极大值或极小值（即一个“模态”）。
   - 例如，一个定义在实数上的单峰函数，在其定义域内只有一个最大值点或最小值点。
   - 这种函数通常在优化问题中较为常见，因为只有一个极值点，搜索最优解的过程相对简单。
2. **多模态函数（Multimodal Function）**：
   - 相比之下，多模态函数在其定义域内拥有多个局部极大值或极小值（即多个“模态”）。
   - 这意味着函数图形上会有多个峰和谷。
   - 在优化问题中，多模态函数通常更具挑战性，因为存在多个局部最优解，找到全局最优解更加困难。



---



##### 9.2 推论【凸函数定义1推广到拟凸函数上

$f:\mathbb{R}^n \rightarrow \mathbb{R}$为拟凸$\Leftrightarrow$dom f为凸，且对所有的$x,y \in dom f, ~~0\le\theta\le 1,$有$f(\theta x+(1-\theta)y)\le  max\{f(x),f(y)\}$



###### 例：向量的长度 $x\in \mathbb{R}^n$

向量的长度指$x$中的最后一个非零元素的位置，那么他是不是拟凸函数呢？函数定义如下：
$$
f(x)=\left\{ \begin{array}{ll} max\{i,x_i\ne0\}&x\ne0\\0&x=0 \end{array}\right.
$$
$\{f(x)\le\alpha\}\Rightarrow$对所有的$i=\lfloor\alpha\rfloor+1,...,n,~~x_i=0$

这样的集合就是一个n维空间的子空间，相当于$\alpha$后的维度全都退化为0，前面的维度可以任意取值，这样的子空间一定是凸集，所有函数为拟凸函数



例：线性分数函数$f(x)=\frac{a^Tx+b}{c^Tx+d},~~domf=\{x|c^Tx+d>0\}$

他不一定是凸函数但**一定是拟凸函数**

$S_\alpha=\{x|c^Tx+d>0,~~\frac{a^Tx+b}{c^Tx+d}\le\alpha\}=\{x|c^Tx+d>0,~~a^Tx+b\le\alpha(c^Tx+d)\}$

这样的集合，x的所有constrain全都是线性的，所以其一定是一个多面体，就是一个凸集

证毕



Quiz 证明几何平均数$f(x)=(x_1\times...\times x_n)^{\frac{1}{n}},x\in\mathbb{R}^n$，在$domf=\mathbb{R}^n_{++}\cap\{\Vert\mathbb{R}\Vert_2\le1\}$为凹

不能直接用二阶条件来做，因为定义域有开有闭



###### 例：如何把一个非凸非拟凸的问题转化为凸或拟凸的问题

向量的零范数$x\in\mathbb{R}^n,~~f(x)=\Vert x\Vert_0$

一个重要问题，$min ~\Vert x\Vert_0$，求稀疏。这样可以对其进行近似，求近似解。

凸松弛：

对其进行松弛，使其变为凸的

比如$min ~\Vert x\Vert_1$将其化为1范数



【所以LASSO其实相当于是零范数的凸松弛

然后再把这个1范数转化为一个$min ~log(x^Tx+1)$



##### 9.3 可微拟凸函数一阶条件：

对于$f(x)$拟凸，函数$domf$为凸，则有$f(y)\le f(x)\Rightarrow\nabla^Tf(x)(y-x)\le0,~~\forall x,y\in domf$的逻辑关系

###### 证明：

仅考虑一维情况：

证明充分（拟凸到逻辑）

$x,y\in domf,~~0\le\theta\le1,max\{f(x),f(y)\}\ge f(\theta x+(1-\theta)y)  $

设$f(y)\le f(x)$

$f(x)\ge f(\theta x+(1-\theta)y)$

开凑，凑x的一阶偏导，上式得：

$f(\theta x+(1-\theta)y) -f(x) \le 0$
等价于

$f(\theta x+(1-\theta)y) -f(\theta x+(1-\theta)x) \le 0$

$\Leftrightarrow \frac{f(\theta x+(1-\theta)y) -f(\theta x+(1-\theta)x)}{(1-\theta)(y-x)}(1-\theta)(y-x)\le0$

当$\underset{\theta\rightarrow1_-}{lim}$存在$\theta$使得，$\Leftrightarrow f'(x)(y-x)\le0$



证明必要（逻辑到拟凸）

$\forall x,y \in domf,x\ne y$，均有$f(y)\le f(x)$则$\nabla^Tf(x)(y-x)\le 0$，在此条件下证明拟凸

取$\forall\theta \in (0,1)$如果$max\{f(x),f(y)\}- f(\theta x+(1-\theta)y)\ge0$那么他就是拟凸函数

设$z=\theta x+(1-\theta)y$

不等式左等于$f(x)\ge f(z)$

那么其实$f(x)$和$f(z)$之间的关系有三种条件，大于等于和小于。那么如果大于，一定成立，下面将小于等于条件考虑在一起，证明小于等于时，其实一定是相当于等于的，这样好能用上条件。对于【有点糊涂

用逻辑条件：
$$
\left\{ \begin{array}{ll}f(x)\le f(z)&\Rightarrow &f'(z)(x-z)\le0\\f(y)\le f(z)&\Rightarrow &f'(z)(y-z)\le0 \end{array}\right.
$$
把$z$和$x,y$关系带入：
$$
\left\{ \begin{array}{ll}f'(z)(1-\theta)(x-y)\le0\\f'(z)\theta(y-x)\le0 \end{array}\right.
$$
这样考虑$\theta$的范围，且$x\ne y$，那么必然有$f'(z)=0$

那么由于z是在x和y之间的连续取值的，所以对于所有可以取到$f(z)\ge f(x)$的取值，都可以推出$f'(z)=0$的结论，也就是说，对于所有想要大于$f(x)$的点，都是不可能的，因为在他等于$f(x)$时，他的一阶导只能是0，无法继续上升了。

因此满足$f(z)\ge f(x)$只能是$f(z)=f(x)$，证毕









$=\frac{f(\theta x+(1-\theta)y) -f(\theta x+(1-\theta)x)}{(1-\theta)(y-x)}(1-\theta)(y-x)$

$\underset{\theta\rightarrow1_-}{lim}$时，$=f'(x)(x-y)\ge0$，证毕



考虑凸函数，有，一阶条件，即偏导为0时，凸函数可以取到极值：

若$\nabla^Tf(x)=0$则$\forall y,~~f(y)\ge f(x)$



对于拟凸函数情况不同：

若$\nabla^Tf(x)=0$，则$\forall y,~~f(y)\le f(x)，$即$0\le0$【？？？虽然不明白，但对于拟凸函数，有很多一阶偏导为0的点，但这些点大部分都是没有什么意义的。



##### 9.4 可微拟凸函数二阶条件：

拟凸函数$domf$为凸，$\Leftrightarrow y^T\nabla f(x)\ge0\Rightarrow y^T\nabla^2f(x)y\ge0$



直观的一维条件下，相当于$yf'(x)\ge0\Rightarrow y^2f''(x)\ge0$，

即$\left\{\begin{array}{ll} y=0&不等式两侧都是0无比较的意义\\f'(x)=0,y\ne0&此时f''(x)\ge0，这样就是有可能局部最优，而不是无意义的点\end{array}\right.$





#### 10. 对数凹/对数凸函数 log concave/log convex 

##### 10.1 对数凹定义：

$f:\mathbb{R}^n \rightarrow \mathbb{R}$，若$f(x)>0,~~\forall x \isin domf$，且$logf$为凹函数，则$f$为$logconcave$

##### 10.2 对数凸定义：

$f:\mathbb{R}^n \rightarrow \mathbb{R}$，若$f(x)>0,~~\forall x \isin domf$，且$logf$为凸函数，则$f$为$logconcave$



来解决一些连乘问题，取log还是很有用的



- 如果一个函数是凸的，那么他的对数函数**不一定凸**
- 反过来，如果一个函数是对数凸的，那么他本身**一定凸**
  - $f=e^{logf}$，指数函数是凸函数，单调不降，logf是凸函数，因此函数的组合一定也是凸的（参见5.4

​	

- 如果一个函数是凹的，那么他一定是**对数凹的**
- 反过来，如果一个函数是对数凹的，那么他本身**不一定凹**



#### 11. 凸优化问题 convex problem

广义的定义：**目标**函数时**凸**函数，**约束**集合是一个**凸**集，这样的**极小化**问题就是凸优化问题



一般优化问题的描述：
$$
minimize&~~f_0(x)\newline subject ~to&~f_i(x)\le 0, i=,...,m~~\newline &h_i(x)=0,i=1,...p
$$
约束就分为**等式约束**和**不等式约束**



##### 11.1 相关定义：

- 优化变量 optimization Variable $x\in \mathbb{R}^n$

- 目标函数/损失函数/效用函数（对于max问题） objective function/loss function/utility function $f_0(x):\mathbb{R}^n\rightarrow\mathbb{R}$

- 不等式约束 inequality constraint $f_i(x)\le 0$

- 等式约束 equality constrain $h_i(x)=0$

- 无约束 unconstrained $m=p=0$

- 域 domain  $D=\bigcap_{i=1}^mdomf_i\cap\bigcap_{i=1}^pdomh_i$

- 可行解集 feasible set $x\in D,~~f_i(x)\le 0, i=,...,m~~ ~~ h_i(x)=0,i=1,...p$ 可行解集为 $X_f=\{x为可行解集\}$

- 最优值 optimal value $p^*=inf\{f_0(x)|x\in X_f\}$ 、

  - 若可行解集为空集，取$p^*=+\infin$ 表达约束等出现问题

- 最优解 optimal point/solution 若$x^*$可行，且$f_0(x^*)=p^*$，$x^*$为最优解

- 最优解集 optimal set 最优解的集合，$X_{opt}=\{x|x\in X_f,~~~f_0(x)=p^*\}$

- $\epsilon$次优解集 $\epsilon$-suboptimal set 发现有时不需要找到一个最优解，达到一定目标即可，即 Satisficing(satisfy suffice) Solution

  - $X_\epsilon=\{x|x\in X_f,~~f_0(x)\le p^*+\epsilon\}$

- 局部最优解 locally optimal $f_0(x)=inf\{f_0(z) \left| \begin{array}{ll}  f_i(z)\le0,~~i=1,...,n \\ h_i(z)=0,i=1,...,p\\\Vert z-x\Vert \le R\end{array} \right. \}$
  - $\exist R \ge 0$使得x可以取到局部最优

- 可行性优化问题 feasibility problems 找到可行域中的值使其可行就可以

  - $find&~~x\newline subject ~to&~f_i(x)\le 0, i=,...,m~~\newline &h_i(x)=0,i=1,...p$

  

###### 一个小问题，为什么约束都是小于等于号而不是小于号？

有概念：

- 若$x\in X_f,~f_i(x)=0,$则称$f_i(x)\le0$为活动约束 active constraint

- 相对的，若$x\in X_f,~f_i(x)<0,$则称$f_i(x)\le0$为活动约束 inactive constraint

而所有的小于的约束：

- 工程上可以月等
- 数学上则可以用一些数学方法，比如加约束条件，松弛变量等将一个小于的转化为标准的小于等于。

因此小于等于其实是一个更好的标准表示方式。



##### 11.2 优化问题的标准化

- 首先是可以通过加入一些等式约束等等使得大于或小于号变为小于等于
- 可以通过一些映射，使得原目标函数变为可以优化的凸函数
- 可以通过一些映射去掉等式约束
  - 比如利用原等式约束$h_i(x)=0,i=1,...p$，找到一个函数$\Phi$使得$x=\Phi(z)$，这样就可以把这个等式带入到原约束和目标函数中，就可以去掉等式约束，并把原约束问题转化为关于$z$的优化问题



###### 例：消除线性等式约束$Ax-b=0,A\in \mathbb{R}^{p\times n}$

分类讨论：

- 原不等式没有解，不考虑
- $A$可逆，则$x=A^{-1}b$
- $x=Fz+x_0$，$F$是$A$矩阵的化零空间，$Ax_0=b$，这样就是一个【通解+特解】的普遍解的结构，也是一个降维。此时的$z$的维度变为了$n-r,r$是矩阵$A$的秩。



##### 11.3 狭义凸优化问题

$$
minimize&~~f_0(x)\newline subject ~to&~f_i(x)\le 0, i=1,...,m~~\newline &a_ix=b_i,i=1,...p
$$

广义的定义：**目标**函数时**凸**函数，**约束**集合是一个**凸**集，这样的**极小化**问题就是凸优化问题

狭义的定义：**目标**函数时**凸**函数，**不等式约束**中的函数都是**凸**函数，**等式约束**都是**仿射函数**



###### 例：广义和狭义

$$
minimize&~~f_0(x)=x_1^2+x_2^2\newline subject ~to&~f_1(x)=\frac{x_1}{1+x_2^2}\le 0~~\newline &h_1(x)=(x_1+x_2)^2=0
$$

狭义上看不是一个凸问题，但广义上时凸问题，因为其实上述问题可以转化为：
$$
minimize&~~f_0(x)=x_1^2+x_2^2\newline subject ~to&~f_1(x)=x_1\le 0~~\newline &h_1(x)=x_1+x_2=0
$$
这两个问题是等价的，但显然下面的从狭义上讲就是一个凸问题了



我们这里**只研究狭义的**凸问题	



###### 例：降维

$$
minimize&~~f_0(Fz+x_0)\newline subject ~to&~f_i(Fz+x_0)\le 0,i=1,...,m
$$

降维看起来不错，但一般不会对问题进行降维，防止一些不必要的麻烦。



###### 例：升维

$$
minimize&~~f_0(x)\newline subject ~to&~s_i\le0,~i=1,...,m\newline &f_i(x)-s_i= 0, i=1,...,m~~\newline &a_ix=b_i,i=1,...p
$$

这里$s_i$表示**松弛变量** slack variable

增加了变量（$s_i$没有表达在目标函数表达式之中）和约束的维度



##### 11.4 拟凸优化 Quasi Convex Optimization

在狭义的凸优化问题的定义下，把目标函数的要求改为**拟凸**的，就变为了一个**拟凸优化**问题

定义：

**目标**函数是**拟凸**函数，**不等式约束**中的函数都是**凸**函数，**等式约束**都是**仿射函数**



##### 11.5 局部最优就是全局最优

凸优化问题之中，**局部最优**解就等于**全局最优解**

证明：

设$x$不是全局最优的，则$\exist y$可行，且$f_0(y)< f_0(x)$

因为$x$是局部最优解，所以$\Vert y-x\Vert_2>R$

构造$z=(1-\theta)x+\theta y$，$\theta=\frac{R}{2\Vert y-x\Vert_2}$，这样$z$也是可行解，且$f_0(z)\le (1-\theta)f_0(x)-\theta f_0(y)$

并有$\Vert z-x\Vert_2 = \theta \Vert x-y \Vert_2=\frac{R}{2}<R$，有$f_0(x)\le f_0(z)$

考虑$y$是全局最优，则有$f_0(y)<f_0(x)\le f_0(z)$，与上述凸集定义的不等式相矛盾

证毕





##### 11.6 可微目标函数情况下的最优性条件

联系一阶条件

- $domf$为凸
- $f(y) \ge f(x)+\nabla f^T(x)(y-x),~~\forall x,y \isin domf$

###### 定义：

设凸问题可行域：

$X_f=\{x|f_i(x)\le0,i=1,..,m~~~h_i(x)=0,i=1,...,p\}$

使得目标函数得到最优值的**解**应该满足：

$\nabla f_0^T(x^*)(y-x^*)\ge0~~~\forall y \in X_f$



【支撑超平面】



###### 例：约束仅为等式约束

$$
minimize&~~f_0(x),domf=\mathbb{R}^n\newline subject ~to&Ax=b
$$

验证最优性不等式：



若$\exist X,~Ax=b,~X$最优，$\Leftrightarrow \forall y,~Ay=b$,$\nabla f_0^T(x)(y-x)\ge0$

因为有$Ax=b,~Ay=b\Rightarrow y=x+v,~v\in \mathbb{N}(A)$，$\mathbb{N}(A)$是$A$的化零空间

$\Rightarrow \nabla f^T_0(x)v\ge0,~~\forall v\in\mathbb{N}(A)$

这里因为$v$布满了整个零子空间，因此要想让上不等式始终成立，有两种可能：

- $v=0$，则说明$Ay=b$只有一个解，$A$是可逆的，那么可行解空间也就只有一点，这一点一定是全局最优解
- $\nabla f^T_0(x)$与$v$正交，显然正交

##### 11.7 互补条件 一阶最优性条件

###### 例：约束仅为非负约束

$$
minimize&~~f_0(x)\newline subject ~to&x\ge0
$$

若$\exist X,~Ax=b,~X$最优，$\Leftrightarrow \forall y,\nabla f_0^T(x)y-\nabla f_0^T(x)x\ge0$

- 若$\exist i,(\nabla f_0^T(x))_i<0$因为$y$可以任意取，则$\nabla f_0^T(x)y$一定可以取负无穷，则必有$\nabla f_0^T(x)\ge0$
- $\forall y$均有$\nabla f_0^T(x)(y-x)\ge0\Rightarrow \nabla f_0^T(x)x\le0$ 因为$y$可以任意取值，所以要满足$y=0$时的条件
- 因为$\nabla f_0^T(x)\ge0,~x\ge0$，那么$\nabla f_0^T(x)x\ge0$，考虑上一条，则有$\nabla f_0^T(x)x=0$

那么可以说，在这样的条件下最优解的条件也被成为**互补条件** complementarity：

- $x\ge0$
- $\nabla f_0(x)\ge0$
- $(\nabla f_0^T(x))_ix_i=0$

互补可以说是，要么梯度为0，要么x值为0



#### 12 典型的凸问题

##### 12.1 线性规划 Linear program

$$
min&~~C^Tx+d&C\in R^{n},d\in R\newline s.t.&~Gx\le h&G\in R^{m\times n},h\in R^n~~\newline &Ax=b&A\in R^{k\times n},b\in R^n
$$

目标与约束均为线性的，其实这些约束共同构成了一个多面体

【linear program 和 linear programming 的小区别：

- 前者指这个问题概念 后者指用这个问题概念来解决一些问题



###### 等价变换：

加入了松弛变量
$$
min&~~C^Tx+d\newline s.t.&~Gx+s= h\newline &Ax=b\newline &s\ge0
$$
那么当我们希望将$x$的正数部分和负数部分分开为$\{x^+,x^-\},x=x^+-x^-$

原问题等价于：
$$
min&~~C^Tx^+-C^Tx^-+d\newline s.t.&~Gx^+-Gx^-+s= h\newline &Ax^+-Ax^-=b\newline &s\ge0,x^+\ge0,x^-\ge0
$$


进而根据以上的线性问题，合并考虑$x^+,x^-,s$，一般会把线性规划问题写成：
$$
min&~~C^Tx\newline s.t. &Ax=b\newline &x\ge0
$$


###### 例：食谱问题

选择食谱，使得m种营养元素，分别不小于$b_1,...,b_m$，有$n$种食物，单位食物营养为$a_{ij},...,a_{nj},~~\forall j=1,...,m$

目标：

单位食物价格最小$c_j$，找出符合营养结构的总价最小的食谱

解：

设食物量分别为$x_1,...,x_n$
$$
min~&\sum_{j=1}^nc_ix_j\newline s.t. &\sum_{j=1}^na_{ij}x_j\ge b_i&i=1,...,m\newline &x_j\ge0&j=1,...,n
$$


向量形式：
$$
\begin{align*}
\text{minimize} \quad & \left[ C_1 \quad C_n \right] \begin{bmatrix} x_1 \\ \vdots \\ x_n \end{bmatrix} \\
\text{subject to} \quad & \begin{bmatrix} A_{11} & \cdots & A_{1n} \\ \vdots & \ddots & \vdots \\ A_{m1} & \cdots & A_{mn} \end{bmatrix} \begin{bmatrix} x_1 \\ \vdots \\ x_n \end{bmatrix} \geq \begin{bmatrix} b_1 \\ \vdots \\ b_m \end{bmatrix} \\
& \begin{bmatrix} x_1 \\ \vdots \\ x_n \end{bmatrix} \geq 0
\end{align*}
$$


###### 例：线性分数规划 linear fractional programming

问题$p_0$：
$$
min&~~f_0(x)\newline s.t.&Gx\le h\newline  &Ax=b
$$
其中目标函数是一个线性分数函数【见3.4】，是拟凸的：$f(x) = \frac{Ax+d}{e^Tx+f}
\newline
\text{dom}_f = \{ x \mid e^Tx+f\geq 0 \}$

等价于问题$p_1$：
$$
min&~~C^Ty+dz\newline s.t.&Gy-hz\le0\newline  &Ay-bz=0\newline &e^Ty+fz=1\newline &z\ge0
$$
证明等价：

第一个方向$p_0\Rightarrow p_1 $：若x在问题$p_0$中可行，那么一定能找到一个$y,z$使得其在问题$p_1$中可行，并且与$x$在$p_0$中函数值相同，有：

$y=\frac{x}{e^Tx+f},z=\frac{1}{e^Tx+f}$

那么根据问题$p_0$的约束以及线性分数函数对于可行域的定义，有如下约束：

$\left\{ \begin{array}{ll}  Gx\le h\\ Ax=b \\ e^Tx+f >0  \end{array} \right.$

那么，用第一个不等式，$Gy-hz=\frac{Gx-h}{e^Tx+f}\le0$

用第二个等式$Ay-bz=\frac{Ax-b}{e^Tx+f}=0$

用$y,z$本身值的特点，因为这里我们给他赋值了$e^Ty+fz=\frac{e^Tx+f}{e^Tx+f}=1$

并且根据最后一个不等式，有$z> 0$一定满足$z\ge 0$

因此给定一个$p_0$的约束一定可有一个对应的$p_1$的约束

此时函数值就是$\frac{Ax+d}{e^Tx+f}$，也是对应了原问题的对应值



第二个方向 $p_1\Rightarrow p_0 $：

若$z>0$，则构造$x=\frac{y}{z}$

【没讲反过来的对应方法

则$x$在$p_0$中可行，且两问题目标函数值相同



若$z=0$，则设$x_0$为$p_0$可行解，则$\forall t>0,x=x_0+ty$也是$p_0$可行解

首先为满足$p_1,~~Gy\le0,Ay=0,e^Ty=1$

带回$p_0$三个约束：$Gx=Gx_o+tGy\le h,~Ax=Ax_0+tAy=b,~e^Tx+f=e^Tx_0+f+te^ty>0$

成立，所以这个射线$x=x_0+ty$都是其可行解

约束等价了，对于目标函数来说：

$f_0(x)=f_0(x_0+ty)=\frac{C^Tx_0+C^Tty+dt}{e^Tx+e^Tty+f}$对t取正无穷极限，并考虑约束$e^Ty=1$，则$\underset{t\rightarrow + \infin}{lim}=C^Ty$



##### 12.2 二次规划 Quadratiz Programming

$$
min  &\frac{1}{2}x^Tpx+q^tx+r&p\in\mathbb{S}_+^n\newline s.t.&Qx\le h\newline &Ax=b
$$

要满足

- 目标函数是**凸函数**
- 不等式约束和等式约束都是**仿射**的



二次规划的最优解与线性规划不同，不会出现在可行集的边界上



约束是非线性时，叫【二次约束的二次规划】Quadratically constrained Quadratic Programming QCQP
$$
min  &\frac{1}{2}x^Tpx+q^tx+r&p\in\mathbb{S}_+^n\newline s.t.&\frac{1}{2}x^Tp_ix+q_i^tx+r_i\le h&p_i\in\mathbb{S}_+^n,i=1,...,n\newline &Ax=b
$$


###### 例：带噪声的测量系统，$b=Ax+e$

$\hat{x}=\underset{x}{argmin}\Vert b-Ax\Vert_2\Rightarrow\underset{x}{argmin}\Vert b-Ax\Vert_2^2$，即使误差的平方和最小

$=\underset{x}{argmin}X^TA^TAx-2b^TAx+b^Tb$显然$A^TA$是半正定的，是一个无约束的二次规划

其中，如果$A$是正定的，即可逆，有最优解$=(A^TA)^{-1}A^Tb$



###### 例：若$x$稀疏

$\hat{x}=\underset{x}{argmin}\Vert b-Ax\Vert_2^2+\lambda_0\Vert x\Vert_0$

加入稀疏项，但0范数难解，近似取1范数

$\hat{x}=\underset{x}{argmin}\Vert b-Ax\Vert_2^2+\lambda_1\Vert x\Vert_1$

就是L1正则项，**LASSO**

但由于1范数是绝对值，不好。为了消除绝对值项，我们用$x=x^+-x^-$来进行等价变换：

$\hat{x}=\underset{x}{argmin}\Vert b-Ax^++Ax^-\Vert_2^2+\lambda_1\Vert x^+-x^-\Vert_1\newline=\underset{x}{argmin}\Vert b-Ax^++Ax^-\Vert_2^2+\lambda_1I^Tx^++\lambda_1I^Tx^-$

并加上约束$x^+,~x^-\ge0$



###### 例：二范数规范化的最小二乘，**岭回归 Ridge**

与上例不同，我们不知道$x$是否稀疏，而$x$其中值的幅度是类似的。那么要满足这个先验知识，就要让其二范数尽可能的小

$\hat{x}=\underset{x}{argmin}\Vert b-Ax\Vert_2^2+\lambda_2\Vert x\Vert_2^2$

$\lambda_2>0$时，一定是一个二次规划问题

他可以写成如下等价的QCQP问题形式：

$\hat{x}=\underset{x}{argmin}&\Vert b-Ax\Vert_2^2\\ s.t.&\Vert x\Vert_2^2\le\theta$

一定可以找到一个$\theta$使得上下最优解相同，可以用以后的【**对偶理论**】解决



###### 例：投资组合问题 portofilo optimization

首先只考虑收益：
$$
max&p_1x_1+...+p_nx_n\\s.t.&x_1+...+x_n\le B\\&x_1,...,x_n\ge0
$$
其中x是资产，p是投资收益率

假设我们的收益率$\bar{P}^T = [1.05~~~1.05~~~1]$

投资的风险（方差）是：$\Sigma=\left[ \begin{array}{ll} 1.2&0&0\\0&2&0\\0&0&0 \end{array}\right]$



那么加入对风险点考量，有：
$$
min&X^T\Sigma X\\s.t.&\bar{P}^Tx\ge r_{min}\\&\mathbb{1}^TX=B\\&x\ge0
$$

- 最小化风险
- 满足投资收益要高于期望
- 所有钱都要投出去





##### 12.3 半正定规划 Semi-Definite Programming SDP



一共有两种形式，第一种：

###### 矩阵形式

$$
min&t_r(cx)\\s.t.&t_r(A_ix)=b_i&i=1,...,p\\&x\succeq0,x\in\mathbb{S}_+^n,C\in \R^{n\times m},A_i\in \R^{n\times n},b_i\in \R
$$

这里面的$x$表示矩阵，通过$\succeq0$约束其是半正定的，这个问题是矩阵空间里面的线性规划问题。

因为有求 **迹 trace** 的操作在矩阵空间中是线性的操作。



###### 例：特例 对角矩阵

$diag\{x\}$取x对角线元素构成的向量

对于对角矩阵，原问题变为：
$$
min &(diag\{c\})^Tdiag\{x\}\\s.t.& diag\{A_i\}^Tdiag\{x\}=b_i&i=1,...,p\\&diag\{x\}\ge0\\&...
&
$$

###### 向量形式

$$
min&c^TX\\
s.t.&x_1A_1+...+x_nA_N\preceq B_i&i=1,...,p\\&x\in \R^n,B~A_1...A_n\in \mathbb{S}^{k},c\in \R^n
$$

其中第一个线性不等式约束表示x和A组合起来的减去B是非半正定的



###### 例：谱范数最小化

 $A(x)=A_0+x_1A_1+...+x_nA_n,~~A_i\in\R^{p\times q},~i=0,...,n,~~x\in\R^n$

那么我们定义$A(x)$的范数是**谱范数** $\Vert A(x) \Vert_2$，其值等于$A(X)$**最大的奇异值**

那么如何找到最小的谱范数？
$$
min&\Vert A(x)\Vert_2\\
$$
有一个线性代数的概念：
$$
\Vert A(x)\Vert_2\le\sqrt{s},s>0\Leftrightarrow A^T(x)A(x)-sI\preceq 0,~~s\in\R
$$
因此原问题可以写成：
$$
min &\sqrt{s}\\s.t.&A^T(x)A(x)\preceq sI&s\in\R
$$

这时候虽然目标函数$\sqrt{s}$不是凸的，但其实相当于极小化$s$，就可以把目标函数换为$s$

为了把他写成矩阵形式，等价于
$$
min &t\\s.t.&A^T(x)A(x)-t^2I&\le0\\&t\ge0
$$
相当于：
$$
min&t\\s.t.&Y=\left[\begin{array}{ll}tI&A(x)\\A^T(x)&tI \end{array}\right]\\&Y\succeq0\\&t\ge0
$$
这样就化成了半正定规划的形式





##### 12.4 多目标优化


$$
min&f_0(x)\\s.t.& f_0(x)\le0&i=1,...,m\\&h_i(x)=0&i=1,...,p\\&f_0:\R^n\rightarrow\R^g,~f_i:\R^n\rightarrow\R,~h_i:\R^n\rightarrow\R
$$
可以看到$f_0$不是一维的了，多个维度就是多目标



例：投资组合的目标可以最小化Risk同时最大化incom
$$
min&Risk\\min&-incom\\s.t.&resource
$$
例：又好又快的发展
$$
min&-speed\\min&-quantity\\s.t.&resource
$$

###### 帕累托最优面：达成最优的边界

任意点若能找到另一解，使得其在某一指标上变得更好，但在其他某指标上变得更差（即无法同时变好），则这些点的集合称为帕累托最优面。【不一定是连续的



oracle solution：所有可行解中，分别使各个变量最优的解的组合



###### 帕累托最优值

对应的函数值

###### 帕累托最优点

对应的策略



###### 单目标转化

若$\{f_0(x)\}$在$\R^k$中为凸，$f_i(x)$为凸，$h_i(x)$为仿射，则必可以通过下述方法求得pareto front中的一点
$$
min&\sum_{i=1}^n\lambda_if_{0i}(x)\\s.t.&f_i(x)\le0&i=1,...,m\\&h_i(x)=0&i=1,...,p
$$
就是通过对多目标加权的方式使得其变为单目标（总目标）的问题。并且通过遍历$\{\lambda_i\}$可以找到pareto front上的所有点



###### 例：ridge regression

###### 多目标-单目标-拉格朗日乘子的联系

$b=Ax+e,~A\in\R^{m\times n},~b\in\R^m,~e\in\R^m,~x\in\R^n$

则目标函数为$min~~\Vert b-Ax\Vert_2^2$然后再加上min正则项（使得x的能量尽可能的小，波动尽量小）因此其实是 【目标】+【正则】的多目标优化
$$
min&\Vert b-Ax\Vert^2_2\\min&\Vert x\Vert^2_2
$$
正常算就会加权并放在一起求单目标：
$$
min&\Vert b-Ax\Vert^2_2+\lambda\Vert x \Vert^2_2\\
$$
或者也可以把第二个目标函数放在约束之中【12.2例题】，等价形式：
$$
min&\Vert b-Ax\Vert^2_2\\s.t.&\Vert x\Vert_2^2\le\epsilon
$$
因此将：

- 多目标优化
- 权重组合的单目标优化
- 把一个目标放在约束中的等价单目标优化

三者联系了起来。



其中后两者的联系涉及到一个重要的概念：**拉格朗日乘子**

约束其实是很讨厌的，而拉格朗日乘子将约束转化到了目标函数之中，大大简化了优化问题







#### 13 对偶性 Duality


$$
min&f_0(x)\\s.t.& f_0(x)\le0&i=1,...,m\\&h_i(x)=0&i=1,...,p
$$
是一个不一定凸的原始的一般问题

假设：

定义域：$x\in\R^n,~~D=\bigcap^m_{i=0}domf_i\cap\bigcap^p_{i=1}domh_i$

原问题的最优值：$p^*$



##### 13.1 拉格朗日函数 lagrangian function

：与上面问题相关的一个函数
$$
L(x,\lambda,v)=f_0(x)+\sum_{i=1}^m\lambda_if_i(x)+\sum_{i=1}^pv_ih_i(x)
$$
$\lambda$与不等式约束的维度相同，$v$与等式约束的维度相同

相当于将这些约束中的函数进行了线性的加权。但这个函数**关于$\lambda$是线性的，关于$v$也是线性的**。



###### 拉格朗日乘子：

$\lambda$ 是与不等式约束相关的拉格朗日乘子

$v$是与等式约束相关的拉格朗日乘子



##### 13.2 拉格朗日对偶函数 Lagrange Dual Function

已知一个拉格朗日函数，那么可以构造一个拉格朗日对偶函数：
$$
g(\lambda,v)=\underset{x\in D}{inf}L(x,\lambda,v)
$$
相当于说，给定一个$\lambda,v$这个函数是找到所有$x$中L的最小值



###### 性质：

- 对偶函数一定是一个凹函数
  - 因为$g(\lambda,v)$关于$\lambda$和$v$其实都是线性的
  - 一簇仿射函数的下确界是凹函数
- $\forall \lambda \ge 0&\forall v&g(\lambda,v)\le p^*\\$其中$p^*$是最初问题的最优值，将对偶函数的函数值和目标函数的最优值联系了起来，进而可以间接求？

证明（第二条性质）：

设$x^*$是原问题的最优解，则其必可行。

则有:

$f_i(x^*)\le0&h_i(x^*)=0\\$

当$\forall \lambda \ge 0&\forall v\\$有

$\sum_{i=1}^m\lambda_if_i(x)+\sum_{i=1}^pv_ih_i(x)\le 0$【所以限制了$\lambda \ge0$

$L(x^*,\lambda,v)=f_0(x^*)+\sum_{i=1}^m\lambda_if_i(x^*)+\sum_{i=1}^pv_ih_i(x^*)\le p^*$

根据$g(\lambda,v)$的定义，所以一定有$g(\lambda,v)\le p^*$



【这样要求原问题的话，极大化$g(\lambda,v)$就好了，而**极大化一个凹函数是一个凸问题！**

###### 例 二次：

$$
min&x^tx\\s.t.&Ax=b\\&x\in\R^n,b\in\R^p,A\in\R^{p\times n}
$$

$\Rightarrow L(x,v)=x^Tx+v^T(Ax-b)$

$\Rightarrow g(v)=\underset{x\in D}{inf}L(x,v)=\underset{x\in D}{inf}(x^Tx+v^TAx-v^Tb)$

想要解开$inf$先求偏导，得到$x$在$-\frac{A^T}{2}$处得到最小值，回带，得：

$\Rightarrow g(v)=-\frac{v^TAA^Tv}{4}-v^Tb=-\frac{v^TAA^Tv}{4}-b^Tv$

这样就是一个凹的函数。



###### 例 等式+不等式 线性：

$$
min&c^Tx\\s.t.&Ax=b\\&x\ge0
$$

$\Rightarrow L(x,v)=c^Tx-\lambda^Tx+v^T(Ax-b)=(c-\lambda+A^Tv)^Tx-b^Tv$

$\Rightarrow g(\lambda,v)=\underset{x\in D}{inf}L(x,\lambda,v)$

观察$L$，可以发现，由于求对偶函数后，x失去了大于等于0的约束，满足其在定义域内即可。而其定义域是全体实数空间，因此当x的系数取0时，其最小值为$-b^Tv$，而其系数不为0时，其最小值当然是负无穷，有：

$\Rightarrow g(\lambda,v)=\left\{ \begin{array}{ll}-b^Tv&A^Tv-\lambda+c=0\\-\infin&otherwise \end{array}\right.$

也是凹的，就相当于函数的扩展。



###### 例 二次 约束非凸：

$$
min&x^Twx\\s.t.&x_i=\pm1&i=1,...,m
$$

$\Rightarrow L(x,v)=x^Twx+\sum_{i=1}^nv_i(x_i^2-1)=x^T(w+diag(v))x-\mathbb{1}^Tv$【因为等于正负一就等价于平方等于1

$\Rightarrow g(v)=\underset{x\in D}{inf}(x^T(w+diag(v))x-\mathbb{1}^Tv)$

相当于一个二次项加一个常数，有：

$\Rightarrow g(v)=\left\{ \begin{array}{ll}-\mathbb{1}^Tv&w+diag(v)\succeq0\\-\infin&otherwise \end{array}\right.$

是凹函数



##### 13.3 对偶和共轭的联系

###### 共轭：

$f:\mathbb{R}^n\rightarrow \mathbb{R},~~f^*:\mathbb{R}^n\rightarrow \mathbb{R}$

有$f^*(y)=\underset{x\in domf}{sup}(y^Tx-f(x))$

称$f^*$是$f$的共轭



###### 例 对偶和共轭的变换：

$$
min&f(x)\\s.t.&x=0
$$

$\Rightarrow L(x,v)=f(x)+v^Tx&domL=domf\cap \R\\$

$\Rightarrow g(v)=\underset{x\in domf}{inf}(f(x)+v^Tx)=-\underset{x\in domf}{sup}(-f(x)-v^Tx)=-f^*(-v)$



###### 例 对偶和共轭的变换：

$$
min&f_0(x)\\s.t.&Ax\le b\\&cx=d
$$

$\Rightarrow L(x,\lambda,v)=f_0(x)+\lambda^T(Ax-b)+v^T(cx-d)=f_0(x)+(\lambda^TA+v^tc)x-\lambda^Tb-v^Td$

$\Rightarrow g(v)=\underset{x\in domf}{inf}L(x,\lambda,v)=-f^*_0(-(\lambda^TA+v^Tc)^T)-\lambda^Tb-v^Td$

【参考上例的做法



##### 13.4 对偶问题性质

首先称原问题为Primal problem P

对偶问题 dual problem D



###### 性质一：

针对原问题P，可以构造对偶问题：
$$
max&g(\lambda,v)\\s.t.&\lambda\ge 0
$$
可以取到最优值$d^*$

- 可以知道$d^*\le p^*$

###### 性质二：

问题D的最优解为$\lambda^*,v^*$，称为 Optimal lagrange multiplier 最优拉格朗日乘子



###### 例 完整三步走：

$$
min&c^Tx\\s.t.&Ax\ge b\\&x\ge0
$$

- 拉格朗日函数

$\Rightarrow L(x,v)=c^Tx-\lambda^Tx+v^T(Ax-b)=(c-\lambda+A^Tv)^Tx-b^Tv$

- 对偶函数

  $\Rightarrow g(\lambda,v)=\left\{ \begin{array}{ll}-b^Tv&A^Tv-\lambda+c=0\\-\infin&otherwise \end{array}\right.$

- 对偶问题

因为在otherwise部分最大值取到负无穷是没有意义的，就可以不考虑这一部分的分类了
$$
\Rightarrow&max&g(\lambda,v)\\&s.t.&\lambda\ge0\\
\Leftrightarrow&max&-b^Tv\\&s.t.&\lambda\ge0\\&&A^Tv-\lambda+c=0\\
\Leftrightarrow&min&b^Tv\\&s.t.&A^Tv+c\ge0
$$
注意max到min的转变虽然保证了最优解$d^*$相同，但最优值不同了



###### 例 三步走：

$$
min&c^Tx\\s.t.&Ax\le b\\
$$

- 拉格朗日函数

$\Rightarrow L(x,\lambda)=x^Tx+\lambda^T(Ax-b)=(c+A^T\lambda)^Tx-b^T\lambda$

- 对偶函数

$\Rightarrow g(\lambda)=\underset{x\in domf}{inf}L(x,\lambda)=\left\{ \begin{array}{ll}-b^Tv&A^T\lambda+c=0\\-\infin&otherwise \end{array}\right.$

- 对偶问题

$$
\Leftrightarrow&min&b^Tv\\&s.t.&\lambda\ge0\\&&A^Tv+c=0\\
$$



同时考虑上面两个问题，有

$P_1$:
$$
min&c^Tx\\s.t.&Ax\ge b\\&x\ge0
$$


$D_1$:
$$
&min&b^Tv\\&s.t.&A^Tv+c\ge0
$$


$P_2$:
$$
min&c^Tx\\s.t.&Ax\le b\\
$$


$D_2$:
$$
&min&b^Tv\\&s.t.&\lambda\ge0\\&&A^Tv+c=0\\
$$
可以看出$D_1$和$P_2$是等价的$D_2$和$P_1$是等价的

也就是说$P_1$的对偶问题的对偶问题是他自身。

那么是不是所有问题对偶的对偶都是他自身？【**不是！！**，类比共轭的共轭

因为对偶问题一定是凸问题，所以当原问题是凹的时候，一定不是。

**那么什么时候是等价的？**



###### 性质三：对偶问题一定是一个凸优化问题



##### 13.5 弱对偶和强对偶

###### 弱对偶：

对于$d^*\le p^*$，叫弱对偶，对于任何对偶都是弱对偶

###### 强对偶：

当上述等号成立时，此时称为强对偶

###### 对偶间隙：

$p^*-d^*$

###### 相对内部 Relation Interior

原问题的域定义为$D$，它有一个相对内部 Relation Interior 记作 Re|int
$$
Re|int~D=\{x\in D|B(x,r)\cap aff~D \subseteq D,\exist r>0 \}
$$

- $B(x,r)$指以x为中心，r为半径的小球
- aff D指D的仿射包【见1.2

相当于去掉原D的所有边缘

###### Slater's condition 【充分条件 使得$p^*=d^*$

若有凸问题
$$
min&f_0(x)\\s.t.&f_i(x)\le0&i=1,...,m\\&Ax=b
$$
其中$\forall i~f_i(x)$为凸

则当$\exist x \in re|int ~D$使得$f_i(x)<0&i=1,...,m&Ax=b\\$满足时，$p^*=d^*$

【满足不等式约束的所有不等号



###### Weaker slater's condition

若**不等式约束为仿射**时，只要可行域非空，必有$p^*=d^*$



此时的相对内部是$re|int ~D = \{domf_0\bigcap\cap_i domf_i\}$

因为Ax=b的dom是全空间，所有的仿射约束的dom也都是全空间，所以可以只考虑$f_0$

$re|int~D=re|int\{domf_0\}$

只要原问题是可行的也就是说可行域非空，那么一定在这个相对内部之中，使得其满足slater 条件



这时的问题就是线性规划问题，有：

###### 线性规划问题若可行，必有$p^*=d^*$



###### 例 weak slater's condtion：

$$
min&x^Tx\\s.t.&Ax=b
$$

对偶问题：
$$
max&-\frac{1}{4}v^TAA^Tv-b^Tv\\
$$
这两个最优值相同



###### 例 QCQP：

$$
min&\frac{1}{2}x^Tp_0x+q_o^Tx+r_0\\s.t.&\frac{1}{2}x^Tp_ix+q_i^Tx+r_i\le0&i=1,...,m\\&p_0\in\mathbb{S}^n_{++},p_i\in\mathbb{S}^n_{+}
$$

拉格朗日函数：
$$
\Rightarrow L(x, \lambda) = \frac{1}{2} x^T p_0 x + q_0^T x + r_0 + \sum_{i=1}^{m} \left( \frac{1}{2} \lambda_i x^T p_i x + \lambda_i q_i^T x + \lambda_i ri \right)\\= \frac{1}{2} x^T \left( p_0 + \sum_{i=1}^{m} \lambda_i p_i \right) x + \left( q_0 + \sum_{i=1}^{m} \lambda_i q_i \right)^T x + \left( r_0 + \sum_{i=1}^{n} \lambda_i r_i \right),
$$
对偶函数：
$$
g(\lambda)=\underset{x}{inf}L(x,\lambda)
$$
由于一开始对$\lambda$没有约束，当$\lambda$某一值小于0时，那么L就不是凸问题了。那么为了保证其凸，即二次系数半正定，那么人为加上约束$\lambda\ge0$

有
$$
g(x,\lambda)=-\frac{1}{2}Q(\lambda)^TP^{-1}(\lambda)Q(\lambda)+R(\lambda)
$$
凹的。其中PQR 分别对应L中三个包含p q r括号的东西


$$
max&-\frac{1}{2}Q(\lambda)^TP^{-1}(\lambda)Q(\lambda)+R(\lambda)\\s.t.&\lambda\ge0
$$
判断是否满足slater 条件：
$$
\exist x\in D=\R^n&\frac{1}{2}x^Tp_ix+q_i^Tx+r_i<0&i=1,...,m\\
$$
则$p^*=d^*$

若$q_i=0&r_i=0&\frac{1}{2}x^Tp_ix\\$虽然不小于0，但由于所有的p都是正定或半正定的，那么原问题最优值只能取0。而对偶问题由于R和Q都是0，最优值只能是0。

【然后老师说及时q r不等于0，也可以找到一个x使得其满足slater 条件。确实，但感觉很乱



##### 13.6 $p^*=d^*$几种解释

$$
min&f_0(x)\\s.t.&f_i(x)\le0&i=1,...,m\\&Ax=b\\&x\in D
$$



###### 几何解释

$$
min&f_0(x)\\s.t.&f_i(x)\le0
$$

对这个最优化问题换一种说法：

定义二维的点集合$G=\{(f_1(x),f_0(x))|x\in D\}$

原问题最优值$p^*=inf\{t|(u,t)\in G,~u\le 0\}$

对偶函数$g(\lambda)=inf\{\lambda u+t|(u,t)\in G\}$

![image-20231124170339472](C:\Users\cimum\AppData\Roaming\Typora\typora-user-images\image-20231124170339472.png)

此时只有弱对偶没有强对偶



![image-20231124170545361](C:\Users\cimum\AppData\Roaming\Typora\typora-user-images\image-20231124170545361.png)

此时有强对偶



###### 鞍点的解释 Saddle point

对于拉格朗日函数$L(x,\lambda)$:

首先一定有$\underset{x\in D}{inf}~\underset{\lambda\ge0}{sup}~L(x,\lambda)\ge~\underset{\lambda\ge0}{sup}~\underset{x\in D}{inf}~L(x,\lambda)$，最小最大值大于等于最大最小值。



其鞍点为$\underset{x\in D}{inf}~\underset{\lambda\ge0}{sup}~L(x,\lambda)=~\underset{\lambda\ge0}{sup}~\underset{x\in D}{inf}~L(x,\lambda)$对应的点，并且有$L(x^*,\lambda)\le L(x^*,\lambda^*)\le L(x,\lambda^*)$ 

这一点$(x^*,\lambda^*)$对x求最小然后对$\lambda$求最大，等同于对$\lambda$求最大然后对x求最小，那么这一点是鞍点。

【马鞍的那个点

因为首先$d^*=\underset{\lambda\ge0}{sup}~\underset{x\in D}{inf}~L(x,\lambda)$

$\underset{x\in D}{inf}~\underset{\lambda\ge0}{sup}~L(x,\lambda)=\underset{x\in D}{inf}~\underset{\lambda\ge0}{sup}(f_0(x)+\sum_{i=1}^m\lambda_if_i(x))$【原问题的等价问题，因为当满足$\lambda\ge0$的条件下的sup，为了不让L取无意义的正无穷，$f_i(x)$只能取小于等于0，此时最大值即是$\lambda_i=0$处取到，这样就退化为了原问题$min\{f_0(x)|f_i(x)\le0\}$】此时$p^*=\underset{x\in D}{inf}~\underset{\lambda\ge0}{sup}~L(x,\lambda)$

这样如果存在一个鞍点的话，$p^*=d^*$



###### 鞍点定理

若$(\tilde{x}, \tilde \lambda)$为$L(x,\lambda)$的鞍点$\Leftrightarrow$强对偶存在，且$\tilde x,\tilde \lambda$为primal（原问题）与dual（对偶问题）的最优解

证明：

证明充分（鞍点到强对偶）：

$\underset{x\in D}{inf}~\underset{\lambda\ge0}{sup}~L(x,\lambda)=~\underset{\lambda\ge0}{sup}~\underset{x\in D}{inf}~L(x,\lambda)$，那么有$p^*=d^*$强对偶存在。

首先根据鞍点的定义，$(\tilde{x}, \tilde \lambda)=\underset{x,\lambda}{arg}~\underset{\lambda\ge0}{sup}~\underset{x\in D}{inf}~L(x,\lambda)$一定成立。那么一定有$\tilde \lambda=\underset{\lambda}{arg}~\underset{\lambda\ge0}{sup}~\underset{x\in D}{inf}~L(x,\lambda)$，就证明了对偶问题的最优解是$\tilde \lambda$，同理可证$\tilde x $是原问题的最优解。

证明充分（强对偶到鞍点）：

首先他是最优解，那么他一定是一个可行解，有
$$
f_i(\tilde x)\le0&i=1,...,m\\ \tilde \lambda\ge0
$$
有强对偶存在：
$$
f_0(\tilde x)=g(\tilde \lambda)=\underset{x}{inf}\{f_0(x)+\sum_{i=0}^m\tilde\lambda_if_i(x)\}\le f_0(\tilde x)+\sum_{i=0}^m\tilde\lambda_if_i(\tilde x)\le f_0(\tilde x)
$$
因此有：
$$
\underset{x}{inf}~L(x,\tilde \lambda)=L(\tilde x,\tilde \lambda)
\\\underset{\lambda\ge0}{sup}~L(\tilde x, \lambda)=\underset{\lambda\ge0}{sup}~f_0(\tilde x)+\sum_{i=0}^m\lambda_if_i(\tilde x)=f_0(\tilde x)=L(\tilde x,\tilde \lambda)
$$
所以根据鞍点的定义，$(\tilde{x}, \tilde \lambda)$是鞍点。

证毕











###### 多目标优化的解释

考虑一个多目标的优化问题：
$$
min&\{f_0(x),...,f_m(x)\}\\
$$
可以为多目标加权，使其转化为一个单目标问题【见12.4
$$
min&f_0(x)+\sum_i\lambda_if_i(x)\\
$$


而回到纯正的单目标问题之中:
$$
min&f_0(x)\\s.t.&f_i(x)\le0&i=1,...,m
$$
可以看到这个但目标问题的拉格朗日函数形式$L(x,\lambda)$和多目标问题相同

首先，求$\underset{x\in D}{min}L(x,\lambda)$，可以进而求得使得对偶问题最优的$\tilde\lambda$。将此$\tilde\lambda$带入拉格朗日函数，。。【不懂



###### 经济学的解释

$$
min&f_0(x)\\s.t.&f_i(x)\le0&i=1,...,m
$$

$x$就指产品数量

$f_0(x)$代表损失

$m$个$f_i(x)$约束表示各种资源的约束





设原材料是可以交易的，且第i种材料的交易价格是$\lambda_i$，那么最终损失就变为$f_0(x)+\sum_i\lambda_if_i(x)$

目标函数变为$\underset{x}{min}~f_0(x)+\sum_i\lambda_if_i(x)$

表示原材料缺了就买，相当于我损失了多少钱。多了就卖掉





那么我假设材料价格是可变的，设有对偶问题$\underset{\lambda\ge0}{max}~g(\lambda)=~\underset{\lambda\ge0}{max}~\underset{x}{min}~f_0(x)+\sum_i\lambda_if_i(x)$

那么此时弱对偶的解释就是，在经济生产的背景下，$d^*\le p^*$表示在原材料可以买卖的情况下，最大损失是低于不能买卖的最小损失的。这在实际的经济生产之中始终合理的。

强对偶时，考虑鞍点定理，就是有最优的生产配置和最优的产品价格$(x^*,\lambda^*)$使得其最优。这个价格$\lambda^*$就是**影子价格**

影子价格的特点：

不想卖出去时：

- $f_i(x^*)\le0$时，不卖出去的剩余原材料的原因是价格$\lambda^*=0$，卖了没有收益

- $\lambda^*>0$时，不卖出去剩余原材料的原因是没有剩余原材料了$f_i(x^*)=0$

  





#### 14 一般问题的原最优解 对偶最优解性质 KKT条件

有原问题
$$
min&f_0(x)\\s.t.& f_0(x)\le0&i=1,...,m\\&h_i(x)=0&i=1,...,p
$$
对偶函数：
$$
g(\lambda,v)=\underset{x}{inf}\{f_0(x)+\sum_{i=1}^m\lambda_if_i(x)+\sum_{i=1}^pv_ih_i(x)\}
$$
对偶问题：
$$
max&g(\lambda,v)\\s.t.&\lambda\ge0
$$


给定强**假设**：

- $p^*=d^*$
- 所有的涉及到的函数都是可微的



此时假设最优解$x^*,\lambda^*,v^*$，需要满足：

- $f_i(x^*)\le0,i=1,...,m$
- $h_i(x^*)=0,i=1,...,p$
- $\lambda^*\ge0$

根据$p^*=d^*$有：
$$
f_0(x^*)=g(\lambda^*,v^*)\\=\underset{x}{inf}\{f_0(x)+\sum_{i=1}^m\lambda_i^*f_i(x)+\sum_{i=1}^pv^*_ih_i(x)\}=\underset{x}{inf}L(x,\lambda^*,v^*)
\\\le f_0(x^*)+\sum_{i=1}^m\lambda_i^*f_i(x^*)+\sum_{i=1}^pv^*_ih_i(x^*)=L(x^*,\lambda^*,v^*)
\\\le f_0(x^*)
$$
因此必然有$\sum_{i=1}^m\lambda_i^*f_i(x^*)=0$，因此考虑约束关系，必然有：

- $\lambda^*>0\Rightarrow f_i(x^*)=0$
- $f_i(x^*)<0\Rightarrow\lambda^*=0$



那么可以通过对第二行的L求偏导，则其在$x^*$处取到偏导为0：$\frac{\partial L(x, \lambda^*,v^*)}{\partial x} |_{x=x^*}  = 0$

有**稳定性 stationarity**：

$\nabla f(x^*) + \sum_{i=1}^{m} \lambda_i^* \nabla f_i(x^*) + \left( \sum_{i=1}^{p} v_i^* \nabla h_i(x^*) \right) = 0$

其中$x^*$是**稳定点**



根据上述的推导，强对偶条件下，原问题和对偶问题的最优解必然满足以下四个条件，合称**KKT条件**：

- 原问题的可行性 primary feasibility：
- 对偶问题可行性 dual feasibility：
- 互补松弛条件
- 稳定性条件

##### 若拉格朗日函数$L(x,\lambda,v)$有鞍点$\Leftrightarrow$此点P,D最优且对偶间隙为零



##### 14.1 原问题的可行性 primary feasibility

- $f_i(x^*)\le0,i=1,...,m$
- $h_i(x^*)=0,i=1,...,p$

##### 14.2 对偶问题可行性 dual feasibility

$\lambda^*\ge0$

##### 14.3 互补松弛条件 complementarity slackness：

强对偶条件下，有$\sum_{i=1}^m\lambda_i^*f_i(x^*)=0$，因此考虑约束关系：

- $\lambda^*>0\Rightarrow f_i(x^*)=0$
- $f_i(x^*)<0\Rightarrow\lambda^*=0$



##### 14.4 稳定性和稳定点

有**稳定性 stationarity**：

$\nabla f(x^*) + \sum_{i=1}^{m} \lambda_i^* \nabla f_i(x^*) + \left( \sum_{i=1}^{p} v_i^* \nabla h_i(x^*) \right) = 0$

其中$x^*$是**稳定点**





但到目前为止，KKT条件是必要的条件。那么什么时候是充要的呢？



##### 14.5 充要KKT

若原问题是**凸**问题，各个函数**可微**，对偶**间隙为零**，则KKT条件为**充要条件**



证明：

必要性 最优解满足KKT条件：上面14开头证好了

充分性 满足KKT条件的是最优解：

设$(\tilde x,\tilde \lambda, \tilde v)$满足KKT条件，则必有$(\tilde x,\tilde \lambda, \tilde v)$为最优解

则需要证明的就是$g(\tilde\lambda,\tilde v)=f_0(\tilde x)$。

而根据：

- 鞍点的定义
- 鞍点定理

有$(\tilde x,\tilde \lambda, \tilde v)$为最优解

接下来证明这个等式：

有KKT条件可行性部分：

- $f_i(x^*)\le0,i=1,...,m$
- $h_i(x^*)=0,i=1,...,p$
- $\lambda^*\ge0$

$L(x,\tilde \lambda,\tilde v)=f_0(x)+\sum_{i=1}^m\tilde\lambda_if_i(x)+\sum_{i=1}^p\tilde v_ih_i(x)$

因为原问题是凸的，根据KKT条件可行性第三条，不等式约束$f_i$是凸函数的非负加权和【11.3】，等式约束$h_i$ 是仿射的，这样整体的$L(x,\tilde \lambda,\tilde v)$就是凸的。可以通过求导为0得到的$\tilde x$是全局的最优点，也就是稳定点：
$$
\frac{\partial L(x,\tilde  \lambda,\tilde v)}{\partial x} |_{x=\tilde x}  = 0
$$


此时$g(\tilde \lambda,\tilde v)=\underset{x}{inf} L(x,\tilde \lambda,\tilde v)=L(\tilde x,\tilde \lambda,\tilde v)=f_0(\tilde x)+\sum_{i=1}^m\tilde\lambda_if_i(\tilde x)+\sum_{i=1}^p\tilde v_ih_i(\tilde x)$

KKT条件的：

- 可行性条件第二条  $h_i(x^*)=0,i=1,...,p$

- 互补松弛条件 $\sum_{i=1}^m\lambda_i^*f_i(x^*)=0$

可以得到$g(\tilde\lambda,\tilde v)=f_0(\tilde x)$





###### 例 二次规划问题：

$$
min&\frac{1}{2}x^Tpx+q^Tx+r\\s.t.&Ax=b\\&p\in\mathbb{S}_+^n
$$



考虑KKT条件，只需要满足$Ax^*=0$

考虑稳定点条件，求偏导：
$$
\frac{\partial}{\partial x} \left\{ \frac{1}{2} x^{*T} P x^* + q^T x^* + r + (A x^* - b)^T u^* \right\} |_{ x^* = x^{*}} = 0\\\Rightarrow P x^* + q + A^T u^* = 0
$$
这样组合两个条件，可以有一个求解矩阵：
$$
\begin{bmatrix}
P & A^T \\
A & 0
\end{bmatrix}
\begin{bmatrix}
x^* \\
u^*
\end{bmatrix}
=
\begin{bmatrix}
-q \\
b
\end{bmatrix}
$$
通过这个矩阵可以非常方便的求解。而考虑KKT本身的其他条件，如果QP问题有不等式约束，显然会引入互补松弛条件，这样会大大增加计算难度



###### 例 灌水问题 water filling 问题：

$$
\begin{align*}
\text{minimize} \quad &  -\sum_{i=1}^{n} \log(x_i + \alpha_i) \\
\text{subject to} \quad & x \geq 0 \\
& \mathbf{1}^T x = 1 \\
& x \in \mathbb{R}^n \\
& \alpha \in \mathbb{R} \\
& \alpha \geq 0
\end{align*}
$$

x代表传输信息的信道上的能量。$\alpha$是一个常数

凸问题，约束凸，目标凸

考虑KKT条件：
$$
x^*\ge0\\1^Tx^*=1\\\lambda^*\ge0\\\lambda^*_ix^*_i=0&i=1,...,n\\\nabla=-\frac{1}{\alpha_i+x_i^*}-\lambda_i^*+v^*=0&i=1,...,n(注意v是1维的)
\\
\\\lambda_i^*=v^*-\frac{1}{\alpha_i+x_i^*}
\\
\\x_i^*(v^*-\frac{1}{\alpha_i+x_i^*})=0&i=1,...,n

\\v^*\ge\frac{1}{\alpha_i+x_i^*}&i=1,...,n
$$
讨论：

- 若$v^*\ge \frac{1}{\alpha_i}$

  - 带入上面的等式 $\Rightarrow x^*_i=0$

- 若$v^*< \frac{1}{\alpha_i}$

  - 带入下面的等式$\Rightarrow x^*_i>0$
  - 则将此结果带入上面的等式：$x_i^*=\frac{1}{v^*}-\alpha_i$

  

###### 例  KKT和一阶最优性条件:

对于问题：
$$
min&f_0(x)\\s.t.&x\ge0
$$
有一阶最优性条件：
$$
\Rightarrow&x\ge0\\&\nabla f_0(x)\ge0\\&x_i(\nabla f_0(x))_i)=0&i=1,...,n
$$

我们来看KKT条件：
$$
KKT\\x^*\ge0\\\lambda^*\ge0\\\lambda_i^*(-x^*_i)=0&i=1,...,m\\\nabla f_0(x^*)+(-\lambda^*)=0\\
\\将最后一条互补松弛带入到前面的可行性条件，把对偶变量消掉后和一阶最优性条件等价了\\
\Leftrightarrow \nabla f_0(x^*)\ge0\\x^*_i(\nabla f_0(x^*))_i)=0&i=1,...,n
$$

##### 等价问题的对偶问题可以是不同的

###### 例：

$$
min~~~f_0(Ax+b)\\
\Rightarrow L(x)=f_0(Ax+b)\\
\Rightarrow g(x)=\underset{x}{inf}~f_0(Ax+b)\\
\Rightarrow max~g
$$

一个等价问题：
$$
min&f_0(y)\\s.t.&Ax+b=y
\\
\\\Rightarrow L(x,y,v)=f_0(y)+v^T(Ax+b-y)\\
\Rightarrow g(v)=\underset{x,y}{inf}~L(x,y,v)\\因为这个情况下约束改变了，没有约束条件了，所以可以分别对x,y求极小\\
\Rightarrow g(v)=\underset{y}{sup}(v^Ty-f_0(y))+\underset{x}{inf}(v^TAx)+v^Tb=\left\{ \begin{array}{ll} -f_0^*(v)+v^Tb&v^TA=0 \\-\infin &v^Ta\ne0 \end{array}\right. \\
对偶问题：
\\
max~~~~~v^Tb-f^*(v)\\s.t.~~~~~v^Tb
$$


###### 例 范数：

$$
\min \| A x - b \| \\
等价问题：\\
\min \| y \| \\
\text{s.t.} \quad y = A x - b \\
L(x, y, v) = \| y \| + v^T (Ax - b - y)=\| y \|-v^Ty+v^TAx-v^Tb, \\
g(v) = \inf_{x, y} L(x, y, v) =\left\{ \begin{array}{ll} -v^Tb-\|v\|_* &v^TA=0\\-\infin &v^TA\ne0 \end{array}\right.\\
对偶问题：
\\max\quad -v^Tb-\|v\|_*\\s.t.\quad v^T=0
$$

另一个改成二次范数的例子
$$
等价问题：\\
\min \frac{1}{2}\| y \|^2 \\
\text{s.t.} \quad y = A x - b \\
L(x, y, v) = \frac{1}{2}\| y \|^2 + v^T (Ax - b - y)=\frac{1}{2}\| y \|^2-v^Ty+v^TAx-v^Tb, \\
g(v) = \inf_{x, y} L(x, y, v) =\left\{ \begin{array}{ll} -v^Tb-\frac{1}{2}\| v \|^2_* &v^TA=0\\-\infin &v^TA\ne0 \end{array}\right.\\
对偶问题：
\\max\quad -v^Tb-\frac{1}{2}\| v \|^2_*\\s.t.\quad v^T=0
$$
这样问题虽然等价，两个对偶问题的最优解最优值都不一样，但对应原问题的最优值仍然是一样的



###### 例：带框约束的线性规划问题

$$
\min \quad \quad C^T X \\
\text{s.t.} \quad \quad A X = b \\
\quad L \preceq X \preceq U 
\quad l_i\le x_i\le u_i \\
L(X, \lambda_1, \lambda_2, U) = 
C^T X + U^T (A X - b) - \lambda_1^T (L - X) + \lambda_2^T (X - U)\\
=(C+A^U-\lambda_1+\lambda_2)X-V^Tb+\lambda_1^TL-\lambda_2^TU
$$



...





#### 15 敏感性分析

##### 15.1 定义

对于优化问题（**原问题**）：
$$
min&f_0(x)\\s.t.& f_0(x)\le0&i=1,...,m\\&h_i(x)=0&i=1,...,p
$$
那么原问题中的约束改变时，最优值/解会发生怎样的改变呢？将约束改变为以下形式（**干扰问题**）：
$$
min&f_0(x)\\s.t.& f_0(x)\le u_i&i=1,...,m\\&h_i(x)=w_i&i=1,...,p
$$


最优值一定有$p^*(u,w)$，最优值是一个有关于u和w的函数。当u，w都为0时，退化为原问题。

##### 15.2 性质

###### 性质一

若原问题为**凸**，则$p^*(u,w)$为关于$(u,w)$的凸函数

证明：

$p^*(u,w)=\inf_{x}\{f_0(x)|f_0(x)\le u_i~~i=1,...,m,~~h_i(x) = w_i~~i=1,...,p\}\\
=\inf_x ~g(x,u,w)\\
g(x,u,w)\triangleq f_0(x),~domg=(domf_0,\R^m,\R^p)\cap D\quad\text{D是原函数的约束域} $

接下来证明$g(x,u,w)$是一个关于$(x,u,w)$的凸函数

- 对于目标函数本身，有$f_0(x)$是凸函数，同时u，w没有出现在目标函数中，因此目标函数为凸
- 对于定义域而言，$domf_0$一定是凸的，而对应的约束域对应于原问题的约束，比如$f_i(x)-u_i$相当于凸加一个仿射，也是一个凸的。因此总体也是联合凸的。

因此$\inf_x g(x,u,w)$也是一个凸函数，也就是$p^*(u,w)$是凸函数



##### 性质二：

若原问题为凸，对偶间隙为零，$\lambda^*,v^*$为原问题的对偶最优解，有
$$
p^*(u,w)\ge p^*(0,0)-\lambda^{*T}u-v^{*T}w
$$
证明：

设$\tilde x$为干扰问题的最优解。有：
$$
f_i(\tilde x)\le u_i&i=1,..,m\\
h_i(\tilde x)= w_i&i=1,..,p\\
$$
有：
$$
p^*(0,0)=g(\lambda^*,v^*)\le f_0(\tilde x)+\sum_{i=1}^m\lambda_if_i(\tilde x)+\sum_{i=1}^pv_ih_i(\tilde x)
$$
考虑上面的不等式：
$$
\Rightarrow \le f_0(\tilde x)+\lambda^{*T}u+v^{*T}w=p^*(u,w)+\lambda^{*T}u+v^{*T}w
$$
调整不等式，证明完毕



- 若$\lambda^*_i$很**大**，且**加紧**第$i$项不等式约束使得$u_i<0$，那么会使得目标函数值急剧上升【资源很贵，如果工厂内存货量还缺的话，会使得收入急剧下降】
- 若$v^*_i$是绝对值大的正值，使$w_i<0$；若$v^*_i$是绝对值大的负值，使$w_i>0$，则会使最优值上升
- 若$\lambda^*_i$很小，且$u_i>0$，则最优值下降不大【资源够多，但价格低，不能多赚太多钱
- 若$v^*_i$是绝对值大的正值，使$w_i>0$；若$v^*_i$是绝对值大的负值，使$w_i<0$，则会使最优值下降的不大



但此时性质二只给定了下界，当下界降低时，我们不知道他改变的方向。因此我们引入性质三：

##### 性质三 局部敏感性：

若原问题为凸，对偶间隙为0，且$p^*(u,w)$在$(u,w)=(0,0)$处**可微**，则有：
$$
\lambda^*_i =- \frac{\part p^*(0,0)}{\part u_i}&v^*_i =- \frac{\part p^*(0,0)}{\part w_i}\\
$$
【利用泰勒展开证

进而有：
$$
p^*(u,w)\approx p^*(0,0)-\lambda^{*T}u-v^{*T}w
$$

##### 例： LP 松弛

Boolean LP 问题
$$
min&c^Tx\\s.t.&Ax\le b\\&x\in \{0,1\}&i=1,...,n
$$
通过对变量进行LP松弛，有：
$$
min&c^Tx\\s.t.&Ax\le b\\&0\le x\le1&i=1,...,n
$$
这样的松弛条件下，最优解没什么意义。但最优值可以为离散的原问题提供了一个下界。



##### 从Primal-dual角度理解LP松弛

boolean LP的等价问题可以写成：
$$
min&c^Tx\\s.t.&Ax\le b\\&x_i(x_i-1)=0&i=1,...,n\\\\
$$

$$
\Rightarrow L(x,\lambda,v)=c^Tx+\lambda^T(Ax-b)+\sum_{i=1}^nv_ix_i^2-\sum_{i=1}^nv_ix_i\\=\sum_{i=1}^nv_ix_i+(c+A\lambda^T-v)^Tx-\lambda^Tb\\
\\\Rightarrow g(\lambda,v)=\inf_x L(x,\lambda,v)=\left\{ \begin{array}{ll} -\lambda^Tb-\frac{1}{4}\sum_{i=1}^n\frac{(c_i+a_i^T\lambda -v_i)^2}{v_i}&v\ge0\\-\infin &otherwise \end{array} \right.
$$

对偶问题：
$$
max&-\lambda^Tb-\frac{1}{4}\sum_{i=1}^n\frac{(c_i+a_i^T\lambda -v_i)^2}{v_i}\\s.t.&\lambda\ge 0,~v\ge0\\
$$
考虑一个优化问题的性质：

当函数$f$中变量不联合时（比如没有xy乘积项），我们有：
$$
\max_{\lambda,v}f(\lambda,v)=\max_\lambda\max_v f(\lambda,v)
$$
进而我们先对任意$\lambda$：
$$
\max_v&-\lambda^Tb-\frac{1}{4}\sum_{i=1}^n\frac{(c_i+a_i^T\lambda -v_i)^2}{v_i}\\s.t.&v\ge0\\
$$
不考虑所有单独带$\lambda$的项，对所有的$i$就有：
$$
=\left\{  \begin{array}{ll}  +c^i+a^T_i\lambda&c^i+a^T_i\lambda\le0\\0&c^i+a^T_i\lambda>0\end{array} \right.\\=\min\{0,c^i+a^T_i\lambda\}
$$
此时考虑$\lambda$：
$$
\Leftrightarrow&\max_\lambda&-\lambda^Tb+\sum^n_{i=1}\min\{0,c^i+a^T_i\lambda\}\\
&s.t.&\lambda\ge0\\
\Leftrightarrow&\max_\lambda&-\lambda^Tb+\mathbb{I}^TW\\
&s.t.&\lambda\ge0\\&&w_i\le 0\\&&w_i\le c^i+a^T_i\lambda
$$




为了找到此等价问题和LP松弛后的问题的联系，我们对LP松弛问题做对偶：
$$
\Rightarrow ~L(x,u,v,w)=c^Tx+u^T(Ax-b)-v^Tx+w^T(x-1)\\
=(c+A^Tu-v+w)^Tx-b^Tu-I^Tw\\
$$

$$
\text{对偶问题}\\
max&-b^Tu-I^Tu\\s.t.&c+A^Tu+w\ge0\\&u\ge0,w\ge0
$$

这样和上面其实是一样的，即

- **LP松弛的对偶问题** 和 **原问题等价问题的对偶** 是**完全一样**的
- 原问题的等价问题的对偶是一个**拉格朗日松弛**，用拉格朗日函数的方法对一个间隙不为零的问题求对偶，可以求得一个下界
- **LP松弛与拉格朗日松弛互为对偶**的



##### 罚函数 带等式约束的可微凸优化问题ma

$$
min&f_0(x)\\s.t.&Ax-b=0
$$

加上罚函数可以消除约束：
$$
min&f_0(x)+\frac{\alpha}{2}\|Ax-b\|_2^2\\
$$
一般$\alpha$要从小取起，然后逐渐增大$\alpha$



对于带有罚函数的最优解$\tilde x$，和原问题最优解有什么联系呢？

对于最优解$\tilde x$，有：
$$
\nabla f_o(\tilde x)+\alpha(A\tilde x-b)=0
$$
那么$\tilde x$也一定是问题：
$$
min&f_0(x)+\alpha(A\tilde x-b)^T(Ax-b)\\
$$
的最优解。

原问题的拉格朗日函数有：
$$
L(x,v)=f_0(x)+v^T(Ax-b)\\\Rightarrow g(x)=\inf_x\{f_0(x)+v^T(Ax-b)\}
$$
































$$

$$



